var canvas = document.querySelector("canvas");
var drawingSurface = canvas.getContext("2d");
var map = [
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 2, 1, 2, 1, 2, 1, 1],
    [1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1],
    [1, 1, 2, 1, 2, 2, 1, 2, 2, 1, 1],
    [1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
];
var shuffle = function (array) {
    var counter = array.length;
    while (counter > 0) {
        var index = Math.floor(Math.random() * counter);
        counter--;
        var temp = array[counter];
        array[counter] = array[index];
        array[index] = temp;
    }
    return array;
};
var gameObjects = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0],
    [0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0],
    [0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
];
var EMPTY = 0;
var FLOOR = 1;
var BOX = 2;
var MONSTER = 3;
var PLAYER = 4;
var WALL = 5;
var SIZE = 64;
var player = null;
var ROWS = map.length;
var COLUMNS = map[0].length;
var tilesheetColumns = 3;
var sprites = [];
var monsters = [];
var boxes = [];
var assetsToLoad = [];
var assetsLoaded = 0;
var LOADING = 0;
var BUILD_MAP = 1;
var PLAYING = 2;
var OVER = 3;
var gameState = LOADING;
var UP = 38;
var DOWN = 40;
var RIGHT = 39;
var LEFT = 37;
var moveUp = false;
var moveDown = false;
var moveRight = false;
var moveLeft = false;
var loadHandler = function () {
    assetsLoaded++;
    if (assetsLoaded === assetsToLoad.length) {
        image.removeEventListener("load", loadHandler, false);
        gameState = BUILD_MAP;
    }
};
var image = new Image();
image.addEventListener("load", loadHandler, false);
image.src = "images/tilesheet.png";
assetsToLoad.push(image);
window.addEventListener("keydown", function (event) {
    switch (event.keyCode) {
        case UP:
            moveUp = true;
            break;
        case DOWN:
            moveDown = true;
            break;
        case LEFT:
            moveLeft = true;
            break;
        case RIGHT:
            moveRight = true;
            break;
    }
}, false);
window.addEventListener("keyup", function (event) {
    switch (event.keyCode) {
        case UP:
            moveUp = false;
            break;
        case DOWN:
            moveDown = false;
            break;
        case LEFT:
            moveLeft = false;
            break;
        case RIGHT:
            moveRight = false;
            break;
    }
}, false);
var buildMap = function (levelMap) {
    for (var row = 0; row < ROWS; row++) {
        for (var column = 0; column < COLUMNS; column++) {
            var currentTile = levelMap[row][column];
            if (currentTile !== EMPTY) {
                var tilesheetX = Math.floor((currentTile - 1) % tilesheetColumns) * SIZE;
                var tilesheetY = Math.floor((currentTile - 1) / tilesheetColumns) * SIZE;
                switch (currentTile) {
                    case FLOOR:
                        var floor = new SpriteObject;
                        floor.sourceX = tilesheetX;
                        floor.sourceY = tilesheetY;
                        floor.x = column * SIZE;
                        floor.y = row * SIZE;
                        sprites.push(floor);
                        break;
                    case BOX:
                        var box = new SpriteObject;
                        box.sourceX = tilesheetX;
                        box.sourceY = tilesheetY;
                        box.x = column * SIZE;
                        box.y = row * SIZE;
                        sprites.push(box);
                        boxes.push(box);
                        break;
                    case WALL:
                        var wall = new SpriteObject;
                        wall.sourceX = tilesheetX;
                        wall.sourceY = tilesheetY;
                        wall.x = column * SIZE;
                        wall.y = row * SIZE;
                        sprites.push(wall);
                        break;
                    case PLAYER:
                        player = new SpriteObject;
                        player.sourceX = tilesheetX;
                        player.sourceY = tilesheetY;
                        player.x = column * SIZE;
                        player.y = row * SIZE;
                        sprites.push(player);
                        break;
                    case MONSTER:
                        var monster = new Enemy();
                        monster.sourceX = tilesheetX;
                        monster.sourceY = tilesheetY;
                        monster.x = column * SIZE;
                        monster.y = row * SIZE;
                        changeDirection(monster);
                        monsters.push(monster);
                        sprites.push(monster);
                        break;
                }
            }
        }
    }
};
var changeDirection = function (monster) {
    monster.validDirections = [];
    monster.direction = monster.NONE;
    var monsterColumn = Math.floor(monster.x / SIZE);
    var monsterRow = Math.floor(monster.y / SIZE);
    if (monsterRow > 0) {
        var thingAbove = map[monsterRow - 1][monsterColumn];
        if (thingAbove === FLOOR) {
            monster.validDirections.push(monster.UP);
        }
    }
    if (monsterRow < ROWS - 1) {
        var thingBelow = map[monsterRow + 1][monsterColumn];
        if (thingBelow === FLOOR) {
            monster.validDirections.push(monster.DOWN);
        }
    }
    if (monsterColumn > 0) {
        var thingToTheLeft = map[monsterRow][monsterColumn - 1];
        if (thingToTheLeft === FLOOR) {
            monster.validDirections.push(monster.LEFT);
        }
    }
    if (monsterColumn < COLUMNS - 1) {
        var thingToTheRight = map[monsterRow][monsterColumn + 1];
        if (thingToTheRight === FLOOR) {
            monster.validDirections.push(monster.RIGHT);
        }
    }
    if (monster.validDirections.length !== 0) {
        var upOrDownPassage = (monster.validDirections.indexOf(monster.UP) !== -1
            || monster.validDirections.indexOf(monster.DOWN) !== -1);
        var leftOrRightPassage = (monster.validDirections.indexOf(monster.LEFT) !== -1
            || monster.validDirections.indexOf(monster.RIGHT) !== -1);
        if (upOrDownPassage && leftOrRightPassage
            || monster.validDirections.length === 1) {
            if (player !== null && monster.hunt === true) {
                findClosestDirection(monster);
            }
            if (monster.direction === monster.NONE) {
                var randomNumber = Math.floor(Math.random() * monster.validDirections.length);
                monster.direction = monster.validDirections[randomNumber];
            }
            switch (monster.direction) {
                case monster.RIGHT:
                    monster.vx = monster.speed;
                    monster.vy = 0;
                    break;
                case monster.LEFT:
                    monster.vx = -monster.speed;
                    monster.vy = 0;
                    break;
                case monster.UP:
                    monster.vx = 0;
                    monster.vy = -monster.speed;
                    break;
                case monster.DOWN:
                    monster.vx = 0;
                    monster.vy = monster.speed;
            }
        }
    }
};
var findClosestDirection = function (monster) {
    var closestDirection = undefined;
    var vx = player.centerX() - monster.centerX();
    var vy = player.centerY() - monster.centerY();
    if (Math.abs(vx) >= Math.abs(vy)) {
        if (vx <= 0) {
            closestDirection = monsterObject.LEFT;
        }
        else {
            closestDirection = monsterObject.RIGHT;
        }
    }
    else {
        if (vy <= 0) {
            closestDirection = monsterObject.UP;
        }
        else {
            closestDirection = monsterObject.DOWN;
        }
    }
    for (var i = 0; i < monster.validDirections.length; i++) {
        if (closestDirection === monster.validDirections[i]) {
            monster.direction = closestDirection;
        }
    }
};
var playGame = function () {
    if (moveUp && !moveDown) {
        player.vy = -4;
    }
    if (moveDown && !moveUp) {
        player.vy = 4;
    }
    if (moveLeft && !moveRight) {
        player.vx = -4;
    }
    if (moveRight && !moveLeft) {
        player.vx = 4;
    }
    if (!moveUp && !moveDown) {
        player.vy = 0;
    }
    if (!moveLeft && !moveRight) {
        player.vx = 0;
    }
    player.x = Math.max(0, Math.min(player.x + player.vx, canvas.width - player.width));
    player.y = Math.max(0, Math.min(player.y + player.vy, canvas.height - player.height));
    for (var i = 0; i < boxes.length; i++) {
        blockRectangle(player, boxes[i]);
    }
    for (var i = 0; i < monsters.length; i++) {
        var monster = monsters[i];
        if (hitTestRectangle(player, monster)) {
            gameState = OVER;
        }
    }
    for (var i = 0; i < monsters.length; i++) {
        var monster = monsters[i];
        monster.x += monster.vx;
        monster.y += monster.vy;
        if (Math.floor(monster.x) % SIZE === 0
            && Math.floor(monster.y) % SIZE === 0) {
            changeDirection(monster);
        }
    }
};
var endGame = function () {
    alert("You have died a horrible death!");
    window.location.reload(true);
};
var render = function () {
    drawingSurface.clearRect(0, 0, canvas.width, canvas.height);
    if (sprites.length !== 0) {
        for (var i = 0; i < sprites.length; i++) {
            var sprite = sprites[i];
            if (sprite.visible) {
                drawingSurface.drawImage(image, sprite.sourceX, sprite.sourceY, sprite.sourceWidth, sprite.sourceHeight, Math.floor(sprite.x), Math.floor(sprite.y), sprite.width, sprite.height);
            }
        }
    }
};
var update = function () {
    requestAnimationFrame(update, canvas);
    switch (gameState) {
        case LOADING:
            console.log("loading...");
            break;
        case BUILD_MAP:
            shuffle(map);
            buildMap(map);
            buildMap(gameObjects);
            gameState = PLAYING;
            break;
        case PLAYING:
            playGame();
            break;
        case OVER:
            endGame();
            break;
    }
    render();
};
update();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLElBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDOUMsSUFBSSxjQUFjLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUc3QyxJQUFJLEdBQUcsR0FDUDtJQUNFLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUN2QixDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7SUFDdkIsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUN2QixDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7SUFDdkIsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUN2QixDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7Q0FDeEIsQ0FBQztBQUdGLElBQUksT0FBTyxHQUFHLFVBQUMsS0FBSztJQUVoQixJQUFJLE9BQU8sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO0lBRzNCLE9BQU8sT0FBTyxHQUFHLENBQUMsRUFBRSxDQUFDO1FBR2pCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxDQUFDO1FBR2hELE9BQU8sRUFBRSxDQUFDO1FBR1YsSUFBSSxJQUFJLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzFCLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDOUIsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQztJQUN4QixDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQztBQUNqQixDQUFDLENBQUE7QUFJRCxJQUFJLFdBQVcsR0FDZjtJQUNFLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUN2QixDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7SUFDdkIsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUN2QixDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7SUFDdkIsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUN2QixDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7Q0FDeEIsQ0FBQztBQUdGLElBQU0sS0FBSyxHQUFHLENBQUMsQ0FBQztBQUNoQixJQUFNLEtBQUssR0FBRyxDQUFDLENBQUM7QUFDaEIsSUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDO0FBQ2QsSUFB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SyxDQUFDO1FBRVIsS0FBSyxJQUFJO1lBQ1AsT0FBTyxFQUFFLENBQUM7WUFDVixLQUFLLENBQUM7SUFDVixDQUFDO0lBR0QsTUFBTSxFQUFFLENBQUM7QUFDWCxDQUFDLENBQUE7QUFFRCxNQUFNLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vVGhlIGNhbnZhc1xyXG5sZXQgY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImNhbnZhc1wiKTtcclxubGV0IGRyYXdpbmdTdXJmYWNlID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuXHJcbi8vVGhlIGdhbWUgbWFwXHJcbmxldCBtYXAgPVxyXG5bXHJcbiAgWzEsMSwxLDEsMSwxLDEsMSwxLDEsMV0sXHJcbiAgWzEsMSwxLDEsMSwxLDEsMSwxLDEsMV0sXHJcbiAgWzEsMSwyLDIsMiwxLDIsMSwyLDEsMV0sXHJcbiAgWzEsMSwxLDIsMSwxLDEsMSwxLDEsMV0sXHJcbiAgWzEsMSwxLDEsMSwyLDEsMSwyLDEsMV0sXHJcbiAgWzEsMSwyLDEsMiwyLDEsMiwyLDEsMV0sXHJcbiAgWzEsMSwxLDEsMSwxLDIsMSwxLDEsMV0sXHJcbiAgWzEsMSwxLDEsMSwxLDEsMSwxLDEsMV1cclxuXTtcclxuXHJcbi8vU2h1ZmZsZSB0aGUgZ2FtZSBtYXAgLy8gRmlzaGVyIHlhdGVzIHNodWZmbGUgLy8gaHR0cDovL3NlZGl0aW9uLmNvbS9wZXJsL2phdmFzY3JpcHQtZnkuaHRtbFxyXG5sZXQgc2h1ZmZsZSA9IChhcnJheSkgPT4ge1xyXG5cclxuICAgIGxldCBjb3VudGVyID0gYXJyYXkubGVuZ3RoO1xyXG5cclxuICAgIC8vIFdoaWxlIHRoZXJlIGFyZSBlbGVtZW50cyBpbiB0aGUgYXJyYXlcclxuICAgIHdoaWxlIChjb3VudGVyID4gMCkge1xyXG5cclxuICAgICAgICAvLyBQaWNrIGEgcmFuZG9tIGluZGV4XHJcbiAgICAgICAgbGV0IGluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY291bnRlcik7XHJcblxyXG4gICAgICAgIC8vIERlY3JlYXNlIGNvdW50ZXIgYnkgMVxyXG4gICAgICAgIGNvdW50ZXItLTtcclxuXHJcbiAgICAgICAgLy8gQW5kIHN3YXAgdGhlIGxhc3QgZWxlbWVudCB3aXRoIGl0XHJcbiAgICAgICAgbGV0IHRlbXAgPSBhcnJheVtjb3VudGVyXTtcclxuICAgICAgICBhcnJheVtjb3VudGVyXSA9IGFycmF5W2luZGV4XTtcclxuICAgICAgICBhcnJheVtpbmRleF0gPSB0ZW1wO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBhcnJheTtcclxufVxyXG5cclxuLy9UaGUgZ2FtZSBvYmplY3RzIG1hcFxyXG5cclxubGV0IGdhbWVPYmplY3RzID1cclxuW1xyXG4gIFswLDAsMCwwLDAsMCwwLDAsMCwwLDBdLFxyXG4gIFswLDAsMCwwLDAsMCwwLDAsMCwzLDBdLFxyXG4gIFswLDMsMCwwLDAsMCwwLDAsMCwwLDBdLFxyXG4gIFswLDAsMCwwLDAsNCwwLDAsMCwwLDBdLFxyXG4gIFswLDAsMywwLDAsMCwwLDAsMCwwLDBdLFxyXG4gIFswLDAsMCwwLDAsMCwwLDAsMCwwLDBdLFxyXG4gIFswLDAsMCwwLDAsMCwwLDAsMCwwLDBdLFxyXG4gIFswLDAsMCwwLDAsMCwwLDAsMCwwLDBdXHJcbl07XHJcblxyXG4vL01hcCBjb2RlXHJcbmNvbnN0IEVNUFRZID0gMDtcclxuY29uc3QgRkxPT1IgPSAxO1xyXG5jb25zdCBCT1ggPSAyO1xyXG5jb25zdCBNT05TVEVSID0gMztcclxuY29uc3QgUExBWUVSID0gNDtcclxuY29uc3QgV0FMTCA9IDU7XHJcblxyXG4vL1RoZSBzaXplIG9mIGVhY2ggdGlsZSBjZWxsXHJcbmxldCBTSVpFID0gNjQ7XHJcblxyXG4vL3dlIGdpdmUgcGxheWVyIGFuIGluaXRpYWwgdmFsdWUgdG8gbnVsbCBiZWNhdXNlIGl0IHdvbid0IGJlIGNyZWF0ZWQgdW50aWwgdGhlIGJ1aWxkTWFwIG9iamVjdCBydW5zLi4uXHJcbmxldCBwbGF5ZXIgPSBudWxsO1xyXG5cclxuLy9UaGUgbnVtYmVyIG9mIHJvd3MgYW5kIGNvbHVtbnNcclxubGV0IFJPV1MgPSBtYXAubGVuZ3RoO1xyXG5sZXQgQ09MVU1OUyA9IG1hcFswXS5sZW5ndGg7XHJcblxyXG4vL1RoZSBudW1iZXIgb2YgY29sdW1ucyBvbiB0aGUgdGlsZXNoZWV0XHJcbmxldCB0aWxlc2hlZXRDb2x1bW5zID0gMztcclxuXHJcbi8vQXJyYXlzIHRvIHN0b3JlIHRoZSBnYW1lIG9iamVjdHNcclxubGV0IHNwcml0ZXMgPSBbXTtcclxubGV0IG1vbnN0ZXJzID0gW107XHJcbmxldCBib3hlcyA9IFtdO1xyXG5cclxubGV0IGFzc2V0c1RvTG9hZCA9IFtdO1xyXG5sZXQgYXNzZXRzTG9hZGVkID0gMDtcclxuXHJcbi8vR2FtZSB2YXJpYWJsZXNcclxuXHJcbi8vR2FtZSBzdGF0ZXNcclxubGV0IExPQURJTkcgPSAwO1xyXG5sZXQgQlVJTERfTUFQID0gMTtcclxubGV0IFBMQVlJTkcgPSAyO1xyXG5sZXQgT1ZFUiA9IDM7XHJcbmxldCBnYW1lU3RhdGUgPSBMT0FESU5HO1xyXG5cclxuLy9BcnJvdyBrZXkgY29kZXNcclxuY29uc3QgVVAgPSAzODtcclxuY29uc3QgRE9XTiA9IDQwO1xyXG5jb25zdCBSSUdIVCA9IDM5O1xyXG5jb25zdCBMRUZUID0gMzc7XHJcblxyXG4vL0RpcmVjdGlvbnNcclxubGV0IG1vdmVVcCA9IGZhbHNlO1xyXG5sZXQgbW92ZURvd24gPSBmYWxzZTtcclxubGV0IG1vdmVSaWdodCA9IGZhbHNlO1xyXG5sZXQgbW92ZUxlZnQgPSBmYWxzZTtcclxuXHJcbi8vVGhlIGxvYWQgaGFuZGxlclxyXG5sZXQgIGxvYWRIYW5kbGVyID0gKCkgPT4ge1xyXG4gIGFzc2V0c0xvYWRlZCsrO1xyXG4gIGlmKGFzc2V0c0xvYWRlZCA9PT0gYXNzZXRzVG9Mb2FkLmxlbmd0aCkge1xyXG4gICAgLy9SZW1vdmUgdGhlIGxvYWQgaGFuZGxlcnNcclxuICAgIGltYWdlLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGxvYWRIYW5kbGVyLCBmYWxzZSk7XHJcblxyXG4gICAgLy9CdWlsZCB0aGUgbWFwXHJcbiAgICBnYW1lU3RhdGUgPSBCVUlMRF9NQVA7XHJcbiAgfVxyXG59XHJcblxyXG4vL0xvYWQgdGhlIHRpbGVzaGVldCBpbWFnZVxyXG5sZXQgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgbG9hZEhhbmRsZXIsIGZhbHNlKTtcclxuaW1hZ2Uuc3JjID0gXCJpbWFnZXMvdGlsZXNoZWV0LnBuZ1wiO1xyXG5hc3NldHNUb0xvYWQucHVzaChpbWFnZSk7XHJcblxyXG4vL0FkZCBrZXlib2FyZCBsaXN0ZW5lcnNcclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChldmVudCkgPT4ge1xyXG4gIHN3aXRjaChldmVudC5rZXlDb2RlKSB7XHJcbiAgICBjYXNlIFVQOlxyXG4gICAgICBtb3ZlVXAgPSB0cnVlO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlIERPV046XHJcbiAgICAgIG1vdmVEb3duID0gdHJ1ZTtcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgY2FzZSBMRUZUOlxyXG4gICAgICBtb3ZlTGVmdCA9IHRydWU7XHJcbiAgICAgIGJyZWFrO1xyXG5cclxuICAgIGNhc2UgUklHSFQ6XHJcbiAgICAgIG1vdmVSaWdodCA9IHRydWU7XHJcbiAgICAgIGJyZWFrO1xyXG4gIH1cclxufSwgZmFsc2UpO1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCAoZXZlbnQpID0+IHtcclxuICBzd2l0Y2goZXZlbnQua2V5Q29kZSkge1xyXG4gICAgY2FzZSBVUDpcclxuICAgICAgbW92ZVVwID0gZmFsc2U7XHJcbiAgICAgIGJyZWFrO1xyXG5cclxuICAgIGNhc2UgRE9XTjpcclxuICAgICAgbW92ZURvd24gPSBmYWxzZTtcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgY2FzZSBMRUZUOlxyXG4gICAgICBtb3ZlTGVmdCA9IGZhbHNlO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlIFJJR0hUOlxyXG4gICAgICBtb3ZlUmlnaHQgPSBmYWxzZTtcclxuICAgICAgYnJlYWs7XHJcbiAgfVxyXG59LCBmYWxzZSk7XHJcblxyXG5sZXQgYnVpbGRNYXAgPSAobGV2ZWxNYXApID0+IHtcclxuICBmb3IobGV0IHJvdyA9IDA7IHJvdyA8IFJPV1M7IHJvdysrKSB7XHJcbiAgICBmb3IobGV0IGNvbHVtbiA9IDA7IGNvbHVtbiA8IENPTFVNTlM7IGNvbHVtbisrKSB7XHJcbiAgICAgIGxldCBjdXJyZW50VGlsZSA9IGxldmVsTWFwW3Jvd11bY29sdW1uXTtcclxuXHJcbiAgICAgIGlmKGN1cnJlbnRUaWxlICE9PSBFTVBUWSkge1xyXG4gICAgICAgIC8vRmluZCB0aGUgdGlsZSdzIHggYW5kIHkgcG9zaXRpb24gb24gdGhlIHRpbGUgc2hlZXRcclxuICAgICAgICBsZXQgdGlsZXNoZWV0WCA9IE1hdGguZmxvb3IoKGN1cnJlbnRUaWxlIC0gMSkgJSB0aWxlc2hlZXRDb2x1bW5zKSAqIFNJWkU7XHJcbiAgICAgICAgbGV0IHRpbGVzaGVldFkgPSBNYXRoLmZsb29yKChjdXJyZW50VGlsZSAtIDEpIC8gdGlsZXNoZWV0Q29sdW1ucykgKiBTSVpFO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGN1cnJlbnRUaWxlKSB7XHJcbiAgICAgICAgICBjYXNlIEZMT09SOlxyXG4gICAgICAgICAgICBsZXQgZmxvb3IgPSBuZXcgU3ByaXRlT2JqZWN0O1xyXG4gICAgICAgICAgICBmbG9vci5zb3VyY2VYID0gdGlsZXNoZWV0WDtcclxuICAgICAgICAgICAgZmxvb3Iuc291cmNlWSA9IHRpbGVzaGVldFk7XHJcbiAgICAgICAgICAgIGZsb29yLnggPSBjb2x1bW4gKiBTSVpFO1xyXG4gICAgICAgICAgICBmbG9vci55ID0gcm93ICogU0laRTtcclxuICAgICAgICAgICAgc3ByaXRlcy5wdXNoKGZsb29yKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgY2FzZSBCT1g6XHJcbiAgICAgICAgICAgIGxldCBib3ggPSBuZXcgU3ByaXRlT2JqZWN0O1xyXG4gICAgICAgICAgICBib3guc291cmNlWCA9IHRpbGVzaGVldFg7XHJcbiAgICAgICAgICAgIGJveC5zb3VyY2VZID0gdGlsZXNoZWV0WTtcclxuICAgICAgICAgICAgYm94LnggPSBjb2x1bW4gKiBTSVpFO1xyXG4gICAgICAgICAgICBib3gueSA9IHJvdyAqIFNJWkU7XHJcbiAgICAgICAgICAgIHNwcml0ZXMucHVzaChib3gpO1xyXG4gICAgICAgICAgICBib3hlcy5wdXNoKGJveCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgIGNhc2UgV0FMTDpcclxuICAgICAgICAgICAgbGV0IHdhbGwgPSBuZXcgU3ByaXRlT2JqZWN0O1xyXG4gICAgICAgICAgICB3YWxsLnNvdXJjZVggPSB0aWxlc2hlZXRYO1xyXG4gICAgICAgICAgICB3YWxsLnNvdXJjZVkgPSB0aWxlc2hlZXRZO1xyXG4gICAgICAgICAgICB3YWxsLnggPSBjb2x1bW4gKiBTSVpFO1xyXG4gICAgICAgICAgICB3YWxsLnkgPSByb3cgKiBTSVpFO1xyXG4gICAgICAgICAgICBzcHJpdGVzLnB1c2god2FsbCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgIGNhc2UgUExBWUVSOlxyXG4gICAgICAgICAgICBwbGF5ZXIgPSBuZXcgU3ByaXRlT2JqZWN0O1xyXG4gICAgICAgICAgICBwbGF5ZXIuc291cmNlWCA9IHRpbGVzaGVldFg7XHJcbiAgICAgICAgICAgIHBsYXllci5zb3VyY2VZID0gdGlsZXNoZWV0WTtcclxuICAgICAgICAgICAgcGxheWVyLnggPSBjb2x1bW4gKiBTSVpFO1xyXG4gICAgICAgICAgICBwbGF5ZXIueSA9IHJvdyAqIFNJWkU7XHJcbiAgICAgICAgICAgIHNwcml0ZXMucHVzaChwbGF5ZXIpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICBjYXNlIE1PTlNURVI6XHJcbiAgICAgICAgICAgIGxldCBtb25zdGVyID0gbmV3IEVuZW15KCk7XHJcbiAgICAgICAgICAgIG1vbnN0ZXIuc291cmNlWCA9IHRpbGVzaGVldFg7XHJcbiAgICAgICAgICAgIG1vbnN0ZXIuc291cmNlWSA9IHRpbGVzaGVldFk7XHJcbiAgICAgICAgICAgIG1vbnN0ZXIueCA9IGNvbHVtbiAqIFNJWkU7XHJcbiAgICAgICAgICAgIG1vbnN0ZXIueSA9IHJvdyAqIFNJWkU7XHJcbiAgICAgICAgICAgIC8vTWFrZSB0aGUgbW9uc3RlciBjaG9vc2UgYSByYW5kb20gc3RhcnQgZGlyZWN0aW9uXHJcbiAgICAgICAgICAgIGNoYW5nZURpcmVjdGlvbihtb25zdGVyKVxyXG4gICAgICAgICAgICBtb25zdGVycy5wdXNoKG1vbnN0ZXIpO1xyXG4gICAgICAgICAgICBzcHJpdGVzLnB1c2gobW9uc3Rlcik7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxubGV0IGNoYW5nZURpcmVjdGlvbiA9IChtb25zdGVyKSA9PiB7XHJcbiAgLy9DbGVhciBhbnkgcHJldmlvdXMgZGlyZWN0aW9uIHRoZSBtb25zdGVyIGhhcyBjaG9zZW5cclxuICBtb25zdGVyLnZhbGlkRGlyZWN0aW9ucyA9IFtdO1xyXG4gIG1vbnN0ZXIuZGlyZWN0aW9uID0gbW9uc3Rlci5OT05FO1xyXG5cclxuICAvL0ZpbmQgdGhlIG1vbnN0ZXIncyBjb2x1bW4gYW5kIHJvdyBpbiB0aGUgYXJyYXlcclxuICBsZXQgbW9uc3RlckNvbHVtbiA9IE1hdGguZmxvb3IobW9uc3Rlci54IC8gU0laRSk7XHJcbiAgbGV0IG1vbnN0ZXJSb3cgPSBNYXRoLmZsb29yKG1vbnN0ZXIueSAvIFNJWkUpO1xyXG5cclxuICAvL0ZpbmQgb3V0IHdoYXQga2luZHMgb2YgdGhpbmdzIGFyZSBpbiB0aGUgbWFwIGNlbGxzXHJcbiAgLy90aGF0IHN1cnJvdW5kIHRoZSBtb25zdGVyLiBJZiB0aGUgY2VsbHMgY29udGFpbiBhIEZMT09SIGNlbGwsXHJcbiAgLy9wdXNoIHRoZSBjb3JyZXNwb25kaW5nIGRpcmVjdGlvbiBpbnRvIHRoZSB2YWxpZERpcmVjdGlvbnMgYXJyYXlcclxuICBpZihtb25zdGVyUm93ID4gMCkge1xyXG4gICAgbGV0IHRoaW5nQWJvdmUgPSBtYXBbbW9uc3RlclJvdyAtIDFdW21vbnN0ZXJDb2x1bW5dO1xyXG4gICAgaWYodGhpbmdBYm92ZSA9PT0gRkxPT1IpIHtcclxuICAgICAgbW9uc3Rlci52YWxpZERpcmVjdGlvbnMucHVzaChtb25zdGVyLlVQKTtcclxuICAgIH1cclxuICB9XHJcbiAgaWYobW9uc3RlclJvdyA8IFJPV1MgLSAxKSB7XHJcbiAgICBsZXQgdGhpbmdCZWxvdyA9IG1hcFttb25zdGVyUm93ICsgMV1bbW9uc3RlckNvbHVtbl07XHJcbiAgICBpZih0aGluZ0JlbG93ID09PSBGTE9PUikge1xyXG4gICAgICBtb25zdGVyLnZhbGlkRGlyZWN0aW9ucy5wdXNoKG1vbnN0ZXIuRE9XTik7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGlmKG1vbnN0ZXJDb2x1bW4gPiAwKSB7XHJcbiAgICBsZXQgdGhpbmdUb1RoZUxlZnQgPSBtYXBbbW9uc3RlclJvd11bbW9uc3RlckNvbHVtbiAtIDFdO1xyXG4gICAgaWYodGhpbmdUb1RoZUxlZnQgPT09IEZMT09SKSB7XHJcbiAgICAgIG1vbnN0ZXIudmFsaWREaXJlY3Rpb25zLnB1c2gobW9uc3Rlci5MRUZUKTtcclxuICAgIH1cclxuICB9XHJcbiAgaWYobW9uc3RlckNvbHVtbiA8IENPTFVNTlMgLSAxKSB7XHJcbiAgICBsZXQgdGhpbmdUb1RoZVJpZ2h0ID0gbWFwW21vbnN0ZXJSb3ddW21vbnN0ZXJDb2x1bW4gKyAxXTtcclxuICAgIGlmKHRoaW5nVG9UaGVSaWdodCA9PT0gRkxPT1IpIHtcclxuICAgICAgbW9uc3Rlci52YWxpZERpcmVjdGlvbnMucHVzaChtb25zdGVyLlJJR0hUKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vVGhlIG1vbnN0ZXIncyB2YWxpZERpcmVjdGlvbnMgYXJyYXkgbm93IGNvbnRhaW5zIDAgdG8gNCBkaXJlY3Rpb25zIHRoYXQgdGhlXHJcbiAgLy9jb250YWluIEZMT09SIGNlbGxzLiBXZSBjaG9vb3NlIFdoaWNoIG9mIHRob3NlIGRpcmVjdGlvbnMgd2lsbCB0aGUgbW9uc3RlclxyXG4gIC8vY2hvb3NlIHRvIG1vdmUgaW4gbmV4dC4uLlxyXG5cclxuICAvL0lmIGEgdmFsaWQgZGlyZWN0aW9uIHdhcyBmb3VuZCwgRmlndXJlIG91dCBpZiB0aGUgbW9uc3RlciBpcyBhdCBhblxyXG4gIC8vbWF6ZSBwYXNzYWdlIGludGVyc2VjdGlvbi5cclxuICBpZihtb25zdGVyLnZhbGlkRGlyZWN0aW9ucy5sZW5ndGggIT09IDApIHtcclxuICAvL0ZpbmQgb3V0IGlmIHRoZSBtb25zdGVyIGlzIGF0IGFuIGludGVyc2VjdGlvblxyXG5cclxuXHRsZXQgdXBPckRvd25QYXNzYWdlXHJcblx0ICA9IChtb25zdGVyLnZhbGlkRGlyZWN0aW9ucy5pbmRleE9mKG1vbnN0ZXIuVVApICE9PSAtMVxyXG5cdCAgfHwgbW9uc3Rlci52YWxpZERpcmVjdGlvbnMuaW5kZXhPZihtb25zdGVyLkRPV04pICE9PSAtMSk7XHJcblxyXG5cdGxldCBsZWZ0T3JSaWdodFBhc3NhZ2VcclxuXHQgID0gKG1vbnN0ZXIudmFsaWREaXJlY3Rpb25zLmluZGV4T2YobW9uc3Rlci5MRUZUKSAhPT0gLTFcclxuXHQgIHx8IG1vbnN0ZXIudmFsaWREaXJlY3Rpb25zLmluZGV4T2YobW9uc3Rlci5SSUdIVCkgIT09IC0xKTtcclxuXHJcbiAgICAvL0NoYW5nZSB0aGUgbW9uc3RlcidzIGRpcmVjdGlvbiBpZiBpdCdzIGF0IGFuIGludGVyc2VjdGlvbiBvclxyXG4gICAgLy9pbiBhIGN1bC1kZS1zYWMgKGRlYWQtZW5kKVxyXG4gICAgaWYodXBPckRvd25QYXNzYWdlICYmIGxlZnRPclJpZ2h0UGFzc2FnZVxyXG5cdHx8IG1vbnN0ZXIudmFsaWREaXJlY3Rpb25zLmxlbmd0aCA9PT0gMSkge1xyXG5cdCAgLy9PcHRpb25hbGx5IGZpbmQgdGhlIGNsb3Nlc3QgZGlzdGFuY2UgdG8gdGhlIHBsYXllclxyXG4gICAgICBpZihwbGF5ZXIgIT09IG51bGwgJiYgbW9uc3Rlci5odW50ID09PSB0cnVlKSB7XHJcbiAgICAgICAgZmluZENsb3Nlc3REaXJlY3Rpb24obW9uc3Rlcik7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vQXNzaWduIGEgcmFuZG9tIHZhbGlkRGlyZWN0aW9uIGlmIGEgdmFsaWREaXJlY3Rpb24gd2Fzbid0IGZvdW5kIHRoYXQgYnJpbmdzIHRoZSBtb25zdGVyIGNsb3NlciB0byB0aGUgcGxheWVyXHJcbiAgICAgIGlmKG1vbnN0ZXIuZGlyZWN0aW9uID09PSBtb25zdGVyLk5PTkUpIHtcclxuXHQgICAgbGV0IHJhbmRvbU51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1vbnN0ZXIudmFsaWREaXJlY3Rpb25zLmxlbmd0aCk7XHJcbiAgICAgICAgbW9uc3Rlci5kaXJlY3Rpb24gPSBtb25zdGVyLnZhbGlkRGlyZWN0aW9uc1tyYW5kb21OdW1iZXJdO1xyXG5cdCAgfVxyXG5cclxuICAgICAgLy9DaG9vc2UgdGhlIG1vbnN0ZXIncyBmaW5hbCBkaXJlY3Rpb25cclxuICAgICAgc3dpdGNoKG1vbnN0ZXIuZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgY2FzZSBtb25zdGVyLlJJR0hUOlxyXG4gICAgICAgICAgbW9uc3Rlci52eCA9IG1vbnN0ZXIuc3BlZWQ7XHJcbiAgICAgICAgICBtb25zdGVyLnZ5ID0gMDtcclxuICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlIG1vbnN0ZXIuTEVGVDpcclxuICAgICAgICAgIG1vbnN0ZXIudnggPSAtbW9uc3Rlci5zcGVlZDtcclxuICAgICAgICAgIG1vbnN0ZXIudnkgPSAwO1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgbW9uc3Rlci5VUDpcclxuICAgICAgICAgIG1vbnN0ZXIudnggPSAwO1xyXG4gICAgICAgICAgbW9uc3Rlci52eSA9IC1tb25zdGVyLnNwZWVkO1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgbW9uc3Rlci5ET1dOOlxyXG4gICAgICAgICAgbW9uc3Rlci52eCA9IDA7XHJcbiAgICAgICAgICBtb25zdGVyLnZ5ID0gbW9uc3Rlci5zcGVlZDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxubGV0IGZpbmRDbG9zZXN0RGlyZWN0aW9uID0gKG1vbnN0ZXIpID0+IHtcclxuICBsZXQgY2xvc2VzdERpcmVjdGlvbiA9IHVuZGVmaW5lZDtcclxuXHJcbiAgLy9GaW5kIHRoZSBkaXN0YW5jZSBiZXR3ZWVuIHRoZSBtb25zdGVyIGFuZCB0aGUgcGxheWVyXHJcbiAgbGV0IHZ4ID0gcGxheWVyLmNlbnRlclgoKSAtIG1vbnN0ZXIuY2VudGVyWCgpO1xyXG4gIGxldCB2eSA9IHBsYXllci5jZW50ZXJZKCkgLSBtb25zdGVyLmNlbnRlclkoKTtcclxuXHJcbiAgLy9JZiB0aGUgZGlzdGFuY2UgaXMgZ3JlYXRlciBvbiB0aGUgeCBheGlzLi4uXHJcbiAgaWYoTWF0aC5hYnModngpID49IE1hdGguYWJzKHZ5KSkge1xyXG4gICAgLy9UcnkgbGVmdCBhbmQgcmlnaHRcclxuICAgIGlmKHZ4IDw9IDApIHtcclxuICAgICAgY2xvc2VzdERpcmVjdGlvbiA9IG1vbnN0ZXJPYmplY3QuTEVGVDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjbG9zZXN0RGlyZWN0aW9uID0gbW9uc3Rlck9iamVjdC5SSUdIVDtcclxuICAgIH1cclxuICB9XHJcbiAgLy9JZiB0aGUgZGlzdGFuY2UgaXMgZ3JlYXRlciBvbiB0aGUgeSBheGlzLi4uXHJcbiAgZWxzZSB7XHJcbiAgICAvL1RyeSB1cCBhbmQgZG93blxyXG4gICAgaWYodnkgPD0gMCkge1xyXG4gICAgICBjbG9zZXN0RGlyZWN0aW9uID0gbW9uc3Rlck9iamVjdC5VUDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjbG9zZXN0RGlyZWN0aW9uID0gbW9uc3Rlck9iamVjdC5ET1dOO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy9GaW5kIG91dCBpZiB0aGUgY2xvc2VzdERpcmVjdGlvbiBpcyBvbmUgb2YgdGhlIHZhbGlkRGlyZWN0aW9uc1xyXG4gIGZvcihsZXQgaSA9IDA7IGkgPCBtb25zdGVyLnZhbGlkRGlyZWN0aW9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgaWYoY2xvc2VzdERpcmVjdGlvbiA9PT0gbW9uc3Rlci52YWxpZERpcmVjdGlvbnNbaV0pIHtcclxuICAgICAgLy9JZiBpdCwgYXNzaWduIHRoZSBjbG9zZXN0RGlyZWN0aW9uIHRvIHRoZSBtb25zdGVyJ3MgZGlyZWN0aW9uXHJcbiAgICAgIG1vbnN0ZXIuZGlyZWN0aW9uID0gY2xvc2VzdERpcmVjdGlvbjtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmxldCBwbGF5R2FtZSA9ICgpID0+IHtcclxuICAvL1VwXHJcbiAgaWYobW92ZVVwICYmICFtb3ZlRG93bikge1xyXG4gICAgcGxheWVyLnZ5ID0gLTQ7XHJcbiAgfVxyXG4gIC8vRG93blxyXG4gIGlmKG1vdmVEb3duICYmICFtb3ZlVXApIHtcclxuICAgIHBsYXllci52eSA9IDQ7XHJcbiAgfVxyXG4gIC8vTGVmdFxyXG4gIGlmKG1vdmVMZWZ0ICYmICFtb3ZlUmlnaHQpIHtcclxuICAgIHBsYXllci52eCA9IC00O1xyXG4gIH1cclxuICAvL1JpZ2h0XHJcbiAgaWYobW92ZVJpZ2h0ICYmICFtb3ZlTGVmdCkge1xyXG4gICAgcGxheWVyLnZ4ID0gNDtcclxuICB9XHJcblxyXG4gIC8vU2V0IHRoZSBwbGF5ZXIncyB2ZWxvY2l0eSB0byB6ZXJvIGlmIG5vbmUgb2YgdGhlIGtleXMgYXJlIGJlaW5nIHByZXNzZWRcclxuICBpZighbW92ZVVwICYmICFtb3ZlRG93bikge1xyXG4gICAgcGxheWVyLnZ5ID0gMDtcclxuICB9XHJcbiAgaWYoIW1vdmVMZWZ0ICYmICFtb3ZlUmlnaHQpIHtcclxuICAgIHBsYXllci52eCA9IDA7XHJcbiAgfVxyXG5cclxuICAvL01vdmUgdGhlIHBsYXllciBhbmQga2VlcCBpdCBpbnNpZGUgdGhlIHNjcmVlbiBib3VuZGFyaWVzXHJcbiAgcGxheWVyLnggPSBNYXRoLm1heCgwLCBNYXRoLm1pbihwbGF5ZXIueCArIHBsYXllci52eCwgY2FudmFzLndpZHRoIC0gcGxheWVyLndpZHRoKSk7XHJcbiAgcGxheWVyLnkgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihwbGF5ZXIueSArIHBsYXllci52eSwgY2FudmFzLmhlaWdodCAtIHBsYXllci5oZWlnaHQpKTtcclxuXHJcbiAgLy9DaGVjayBmb3IgY29sbGlzaW9ucyBiZXR3ZWVuIHRoZSBwbGF5ZXIgYW5kIHRoZSBib3hlc1xyXG4gIGZvcihsZXQgaSA9IDA7IGkgPCBib3hlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgYmxvY2tSZWN0YW5nbGUocGxheWVyLCBib3hlc1tpXSk7XHJcbiAgfVxyXG5cclxuICAvL0NoZWNrIGZvciBjb2xsaXNpb25zIHdpdGggbW9uc3RlcnNcclxuICBmb3IobGV0IGk9MDsgaTwgbW9uc3RlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgIGxldCBtb25zdGVyID0gbW9uc3RlcnNbaV07XHJcbiAgICBpZihoaXRUZXN0UmVjdGFuZ2xlKHBsYXllciwgbW9uc3RlcikpIHtcclxuICAgICAgZ2FtZVN0YXRlID0gT1ZFUjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vVGhlIG1vbnN0ZXJzXHJcbiAgZm9yKGxldCBpID0gMDsgaSA8IG1vbnN0ZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICBsZXQgbW9uc3RlciA9IG1vbnN0ZXJzW2ldO1xyXG5cclxuICAgIC8vTW92ZSB0aGUgbW9uc3RlcnNcclxuICAgIG1vbnN0ZXIueCArPSBtb25zdGVyLnZ4O1xyXG4gICAgbW9uc3Rlci55ICs9IG1vbnN0ZXIudnk7XHJcblxyXG4gICAgLy9DaGVjayB3aGV0aGVyIHRoZSBtb25zdGVyIGlzIGF0IGEgdGlsZSBjb3JuZXJcclxuICAgIGlmKE1hdGguZmxvb3IobW9uc3Rlci54KSAlIFNJWkUgPT09IDBcclxuICAgICYmIE1hdGguZmxvb3IobW9uc3Rlci55KSAlIFNJWkUgPT09IDApIHtcclxuICAgICAgLy9DaGFuZ2UgdGhlIG1vbnN0ZXIncyBkaXJlY3Rpb25cclxuICAgICAgY2hhbmdlRGlyZWN0aW9uKG1vbnN0ZXIpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxubGV0IGVuZEdhbWUgPSAoKSA9PiB7XHJcbiAgYWxlcnQoXCJZb3UgaGF2ZSBkaWVkIGEgaG9ycmlibGUgZGVhdGghXCIpO1xyXG4gIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQodHJ1ZSlcclxufVxyXG5cclxubGV0IHJlbmRlciA9ICgpID0+IHtcclxuICBkcmF3aW5nU3VyZmFjZS5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcclxuXHJcbiAgLy9EaXNwbGF5IHRoZSBzcHJpdGVzXHJcbiAgaWYoc3ByaXRlcy5sZW5ndGggIT09IDApIHtcclxuICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzcHJpdGVzLmxlbmd0aDsgaSsrKSB7XHJcblx0ICBsZXQgc3ByaXRlID0gc3ByaXRlc1tpXTtcclxuXHQgIGlmKHNwcml0ZS52aXNpYmxlKSB7XHJcbiAgICAgICAgZHJhd2luZ1N1cmZhY2UuZHJhd0ltYWdlXHJcbiAgICAgICAgKFxyXG4gICAgICAgICAgIGltYWdlLFxyXG4gICAgICAgICAgIHNwcml0ZS5zb3VyY2VYLCBzcHJpdGUuc291cmNlWSxcclxuICAgICAgICAgICBzcHJpdGUuc291cmNlV2lkdGgsIHNwcml0ZS5zb3VyY2VIZWlnaHQsXHJcbiAgICAgICAgICAgTWF0aC5mbG9vcihzcHJpdGUueCksIE1hdGguZmxvb3Ioc3ByaXRlLnkpLFxyXG4gICAgICAgICAgIHNwcml0ZS53aWR0aCwgc3ByaXRlLmhlaWdodFxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmxldCAgdXBkYXRlID0gKCkgPT4ge1xyXG4gIC8vVGhlIGFuaW1hdGlvbiBsb29wXHJcbiAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHVwZGF0ZSwgY2FudmFzKTtcclxuXHJcbiAgLy9DaGFuZ2Ugd2hhdCB0aGUgZ2FtZSBpcyBkb2luZyBiYXNlZCBvbiB0aGUgZ2FtZSBzdGF0ZVxyXG4gIHN3aXRjaChnYW1lU3RhdGUpIHtcclxuICAgIGNhc2UgTE9BRElORzpcclxuICAgICAgY29uc29sZS5sb2coXCJsb2FkaW5nLi4uXCIpO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlIEJVSUxEX01BUDpcclxuICAgICAgc2h1ZmZsZShtYXApO1xyXG4gICAgICBidWlsZE1hcChtYXApO1xyXG4gICAgICBidWlsZE1hcChnYW1lT2JqZWN0cyk7XHJcbiAgICAgIC8vY3JlYXRlT3RoZXJPYmplY3RzKCk7XHJcbiAgICAgIGdhbWVTdGF0ZSA9IFBMQVlJTkc7XHJcbiAgICAgIGJyZWFrO1xyXG5cclxuICAgIGNhc2UgUExBWUlORzpcclxuICAgICAgcGxheUdhbWUoKTtcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgY2FzZSBPVkVSOlxyXG4gICAgICBlbmRHYW1lKCk7XHJcbiAgICAgIGJyZWFrO1xyXG4gIH1cclxuXHJcbiAgLy9SZW5kZXIgdGhlIGdhbWVcclxuICByZW5kZXIoKTtcclxufVxyXG4vL1N0YXJ0IHRoZSBnYW1lIGFuaW1hdGlvbiBsb29wXHJcbnVwZGF0ZSgpO1xyXG4iXX0=