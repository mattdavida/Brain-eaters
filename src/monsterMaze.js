(function () {
    var canvas = document.querySelector("canvas");
    var drawingSurface = canvas.getContext("2d");
    var map = [
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 1, 2, 2, 2, 1, 2, 1, 2, 1, 1],
        [1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1],
        [1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1],
        [1, 1, 2, 1, 2, 2, 1, 2, 2, 1, 1],
        [1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    ];
    function shuffle(array) {
        var counter = array.length;
        while (counter > 0) {
            var index = Math.floor(Math.random() * counter);
            counter--;
            var temp = array[counter];
            array[counter] = array[index];
            array[index] = temp;
        }
        return array;
    }
    var gameObjects = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0],
        [0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0],
        [0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    ];
    var EMPTY = 0;
    var FLOOR = 1;
    var BOX = 2;
    var MONSTER = 3;
    var PLAYER = 4;
    var WALL = 5;
    var SIZE = 64;
    var player = null;
    var ROWS = map.length;
    var COLUMNS = map[0].length;
    var tilesheetColumns = 3;
    var sprites = [];
    var monsters = [];
    var boxes = [];
    var assetsToLoad = [];
    var assetsLoaded = 0;
    var image = new Image();
    image.addEventListener("load", loadHandler, false);
    image.src = "images/tilesheet.png";
    assetsToLoad.push(image);
    var LOADING = 0;
    var BUILD_MAP = 1;
    var PLAYING = 2;
    var OVER = 3;
    var gameState = LOADING;
    var UP = 38;
    var DOWN = 40;
    var RIGHT = 39;
    var LEFT = 37;
    var moveUp = false;
    var moveDown = false;
    var moveRight = false;
    var moveLeft = false;
    window.addEventListener("keydown", function (event) {
        switch (event.keyCode) {
            case UP:
                moveUp = true;
                break;
            case DOWN:
                moveDown = true;
                break;
            case LEFT:
                moveLeft = true;
                break;
            case RIGHT:
                moveRight = true;
                break;
        }
    }, false);
    window.addEventListener("keyup", function (event) {
        switch (event.keyCode) {
            case UP:
                moveUp = false;
                break;
            case DOWN:
                moveDown = false;
                break;
            case LEFT:
                moveLeft = false;
                break;
            case RIGHT:
                moveRight = false;
                break;
        }
    }, false);
    update();
    function update() {
        requestAnimationFrame(update, canvas);
        switch (gameState) {
            case LOADING:
                console.log("loading...");
                break;
            case BUILD_MAP:
                shuffle(map);
                buildMap(map);
                buildMap(gameObjects);
                gameState = PLAYING;
                break;
            case PLAYING:
                playGame();
                break;
            case OVER:
                endGame();
                break;
        }
        render();
    }
    function loadHandler() {
        assetsLoaded++;
        if (assetsLoaded === assetsToLoad.length) {
            image.removeEventListener("load", loadHandler, false);
            gameState = BUILD_MAP;
        }
    }
    function buildMap(levelMap) {
        for (var row = 0; row < ROWS; row++) {
            for (var column = 0; column < COLUMNS; column++) {
                var currentTile = levelMap[row][column];
                if (currentTile !== EMPTY) {
                    var tilesheetX = Math.floor((currentTile - 1) % tilesheetColumns) * SIZE;
                    var tilesheetY = Math.floor((currentTile - 1) / tilesheetColumns) * SIZE;
                    switch (currentTile) {
                        case FLOOR:
                            var floor = new SpriteObject;
                            floor.sourceX = tilesheetX;
                            floor.sourceY = tilesheetY;
                            floor.x = column * SIZE;
                            floor.y = row * SIZE;
                            sprites.push(floor);
                            break;
                        case BOX:
                            var box = new SpriteObject;
                            box.sourceX = tilesheetX;
                            box.sourceY = tilesheetY;
                            box.x = column * SIZE;
                            box.y = row * SIZE;
                            sprites.push(box);
                            boxes.push(box);
                            break;
                        case WALL:
                            var wall = new SpriteObject;
                            wall.sourceX = tilesheetX;
                            wall.sourceY = tilesheetY;
                            wall.x = column * SIZE;
                            wall.y = row * SIZE;
                            sprites.push(wall);
                            break;
                        case PLAYER:
                            player = new SpriteObject;
                            player.sourceX = tilesheetX;
                            player.sourceY = tilesheetY;
                            player.x = column * SIZE;
                            player.y = row * SIZE;
                            sprites.push(player);
                            break;
                        case MONSTER:
                            var monster = new Enemy();
                            monster.sourceX = tilesheetX;
                            monster.sourceY = tilesheetY;
                            monster.x = column * SIZE;
                            monster.y = row * SIZE;
                            changeDirection(monster);
                            monsters.push(monster);
                            sprites.push(monster);
                            break;
                    }
                }
            }
        }
    }
    function changeDirection(monster) {
        monster.validDirections = [];
        monster.direction = monster.NONE;
        var monsterColumn = Math.floor(monster.x / SIZE);
        var monsterRow = Math.floor(monster.y / SIZE);
        if (monsterRow > 0) {
            var thingAbove = map[monsterRow - 1][monsterColumn];
            if (thingAbove === FLOOR) {
                monster.validDirections.push(monster.UP);
            }
        }
        if (monsterRow < ROWS - 1) {
            var thingBelow = map[monsterRow + 1][monsterColumn];
            if (thingBelow === FLOOR) {
                monster.validDirections.push(monster.DOWN);
            }
        }
        if (monsterColumn > 0) {
            var thingToTheLeft = map[monsterRow][monsterColumn - 1];
            if (thingToTheLeft === FLOOR) {
                monster.validDirections.push(monster.LEFT);
            }
        }
        if (monsterColumn < COLUMNS - 1) {
            var thingToTheRight = map[monsterRow][monsterColumn + 1];
            if (thingToTheRight === FLOOR) {
                monster.validDirections.push(monster.RIGHT);
            }
        }
        if (monster.validDirections.length !== 0) {
            var upOrDownPassage = (monster.validDirections.indexOf(monster.UP) !== -1
                || monster.validDirections.indexOf(monster.DOWN) !== -1);
            var leftOrRightPassage = (monster.validDirections.indexOf(monster.LEFT) !== -1
                || monster.validDirections.indexOf(monster.RIGHT) !== -1);
            if (upOrDownPassage && leftOrRightPassage
                || monster.validDirections.length === 1) {
                if (player !== null && monster.hunt === true) {
                    findClosestDirection(monster);
                }
                if (player === null || monster.direction === monster.NONE) {
                    var randomNumber = Math.floor(Math.random() * monster.validDirections.length);
                    monster.direction = monster.validDirections[randomNumber];
                }
                switch (monster.direction) {
                    case monster.RIGHT:
                        monster.vx = monster.speed;
                        monster.vy = 0;
                        break;
                    case monster.LEFT:
                        monster.vx = -monster.speed;
                        monster.vy = 0;
                        break;
                    case monster.UP:
                        monster.vx = 0;
                        monster.vy = -monster.speed;
                        break;
                    case monster.DOWN:
                        monster.vx = 0;
                        monster.vy = monster.speed;
                }
            }
        }
    }
    function findClosestDirection(monster) {
        var closestDirection = undefined;
        var vx = player.centerX() - monster.centerX();
        var vy = player.centerY() - monster.centerY();
        if (Math.abs(vx) >= Math.abs(vy)) {
            if (vx <= 0) {
                closestDirection = monsterObject.LEFT;
            }
            else {
                closestDirection = monsterObject.RIGHT;
            }
        }
        else {
            if (vy <= 0) {
                closestDirection = monsterObject.UP;
            }
            else {
                closestDirection = monsterObject.DOWN;
            }
        }
        for (var i = 0; i < monster.validDirections.length; i++) {
            if (closestDirection === monster.validDirections[i]) {
                monster.direction = closestDirection;
            }
        }
    }
    function playGame() {
        if (moveUp && !moveDown) {
            player.vy = -4;
        }
        if (moveDown && !moveUp) {
            player.vy = 4;
        }
        if (moveLeft && !moveRight) {
            player.vx = -4;
        }
        if (moveRight && !moveLeft) {
            player.vx = 4;
        }
        if (!moveUp && !moveDown) {
            player.vy = 0;
        }
        if (!moveLeft && !moveRight) {
            player.vx = 0;
        }
        player.x = Math.max(0, Math.min(player.x + player.vx, canvas.width - player.width));
        player.y = Math.max(0, Math.min(player.y + player.vy, canvas.height - player.height));
        for (var i = 0; i < boxes.length; i++) {
            blockRectangle(player, boxes[i]);
        }
        for (var i = 0; i < monsters.length; i++) {
            var monster = monsters[i];
            if (hitTestRectangle(player, monster)) {
                gameState = OVER;
            }
        }
        for (var i = 0; i < monsters.length; i++) {
            var monster = monsters[i];
            monster.x += monster.vx;
            monster.y += monster.vy;
            if (Math.floor(monster.x) % SIZE === 0
                && Math.floor(monster.y) % SIZE === 0) {
                changeDirection(monster);
            }
        }
    }
    function endGame() {
        alert("You Lost");
        window.location.reload(true);
    }
    function render() {
        drawingSurface.clearRect(0, 0, canvas.width, canvas.height);
        if (sprites.length !== 0) {
            for (var i = 0; i < sprites.length; i++) {
                var sprite = sprites[i];
                if (sprite.visible) {
                    drawingSurface.drawImage(image, sprite.sourceX, sprite.sourceY, sprite.sourceWidth, sprite.sourceHeight, Math.floor(sprite.x), Math.floor(sprite.y), sprite.width, sprite.height);
                }
            }
        }
    }
}());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uc3Rlck1hemUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJtb25zdGVyTWF6ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxDQUFDO0lBR0QsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUM5QyxJQUFJLGNBQWMsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRzdDLElBQUksR0FBRyxHQUNQO1FBQ0UsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7UUFDdkIsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7UUFDdkIsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztLQUN4QixDQUFDO0lBRUYsaUJBQWlCLEtBQUs7UUFFbEIsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUczQixPQUFPLE9BQU8sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUdqQixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsQ0FBQztZQUdoRCxPQUFPLEVBQUUsQ0FBQztZQUdWLElBQUksSUFBSSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUMxQixLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlCLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDeEIsQ0FBQztRQUVELE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQU1ELElBQUksV0FBVyxHQUNmO1FBQ0UsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7UUFDdkIsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7UUFDdkIsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztLQUN4QixDQUFDO0lBR0YsSUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ2hCLElBQU0sS0FBSyxHQUFHLENBQUMsQ0FBQztJQUNoQixJQUFNLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDZCxJQUFNLE9BQU8sR0FBRyxDQUFDLENBQUM7SUFDbEIsSUFBTSxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ2pCLElBQU0sSUFBSSxHQUFHLENBQUMsQ0FBQztJQUdmLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUdkLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQztJQUdsQixJQUFJLElBQUksR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDO0lBQ3RCLElBQUksT0FBTyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7SUFHNUIsSUFBSSxnQkFBZ0IsR0FBRyxDQUFDLENBQUM7SUFHekIsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDO0lBQ2pCLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQztJQUNsQixJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7SUFFZixJQUFJLFlBQVksR0FBRyxFQUFFLENBQUM7SUFDdEIsSUFBSSxZQUFZLEdBQUcsQ0FBQyxDQUFDO0lBR3JCLElBQUksS0FBSyxHQUFHLElBQUksS0FBSyxFQUFFLENBQUM7SUFDeEIsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDbkQsS0FBSyxDQUFDLEdBQUcsR0FBRyxzQkFBc0IsQ0FBQztJQUNuQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBS3pCLElBQUksT0FBTyxHQUFHLENBQUMsQ0FBQztJQUNoQixJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUM7SUFDbEIsSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFDO0lBQ2hCLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQztJQUNiLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQztJQUd4QixJQUFNLEVBQUUsR0FBRyxFQUFFLENBQUM7SUFDZCxJQUFNLElBQUksR0FBRyxFQUFFLENBQUM7SUFDaEIsSUFBTSxLQUFLLEdBQUcsRUFBRSxDQUFDO0lBQ2pCLElBQU0sSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUdoQixJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUM7SUFDbkIsSUFBSSxRQUFRLEdBQUcsS0FBSyxDQUFDO0lBQ3JCLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztJQUN0QixJQUFJLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFHckIsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxVQUFTLEtBQUs7UUFDL0MsTUFBTSxDQUFBLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDckIsS0FBSyxFQUFFO2dCQUNMLE1BQU0sR0FBRyxJQUFJLENBQUM7Z0JBQ2QsS0FBSyxDQUFDO1lBRVIsS0FBSyxJQUFJO2dCQUNQLFFBQVEsR0FBRyxJQUFJLENBQUM7Z0JBQ2hCLEtBQUssQ0FBQztZQUVSLEtBQUssSUFBSTtnQkFDUCxRQUFRLEdBQUcsSUFBSSxDQUFDO2dCQUNoQixLQUFLLENBQUM7WUFFUixLQUFLLEtBQUs7Z0JBQ1IsU0FBUyxHQUFHLElBQUksQ0FBQztnQkFDakIsS0FBSyxDQUFDO1FBQ1YsQ0FBQztJQUNILENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUVWLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsVUFBUyxLQUFLO1FBQzdDLE1BQU0sQ0FBQSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLEtBQUssRUFBRTtnQkFDTCxNQUFNLEdBQUcsS0FBSyxDQUFDO2dCQUNmLEtBQUssQ0FBQztZQUVSLEtBQUssSUFBSTtnQkFDUCxRQUFRLEdBQUcsS0FBSyxDQUFDO2dCQUNqQixLQUFLLENBQUM7WUFFUixLQUFLLElBQUk7Z0JBQ1AsUUFBUSxHQUFHLEtBQUssQ0FBQztnQkFDakIsS0FBSyxDQUFDO1lBRVIsS0FBSyxLQUFLO2dCQUNSLFNBQVMsR0FBRyxLQUFLLENBQUM7Z0JBQ2xCLEtBQUssQ0FBQztRQUNWLENBQUM7SUFDSCxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFHVixNQUFNLEVBQUUsQ0FBQztJQUVUO1FBRUUscUJBQXFCLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBR3RDLE1BQU0sQ0FBQSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDakIsS0FBSyxPQUFPO2dCQUNWLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQzFCLEtBQUssQ0FBQztZQUVSLEtBQUssU0FBUztnQkFDWixPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ2IsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNkLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFFdEIsU0FBUyxHQUFHLE9BQU8sQ0FBQztnQkFDcEIsS0FBSyxDQUFDO1lBRVIsS0FBSyxPQUFPO2dCQUNWLFFBQVEsRUFBRSxDQUFDO2dCQUNYLEtBQUssQ0FBQztZQUVSLEtBQUssSUFBSTtnQkFDUCxPQUFPLEVBQUUsQ0FBQztnQkFDVixLQUFLLENBQUM7UUFDVixDQUFDO1FBR0QsTUFBTSxFQUFFLENBQUM7SUFDWCxDQUFDO0lBRUQ7UUFDRSxZQUFZLEVBQUUsQ0FBQztRQUNmLEVBQUUsQ0FBQSxDQUFDLFlBQVksS0FBSyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUV4QyxLQUFLLENBQUMsbUJBQW1CLENBQUMsTUFBTSxFQUFFLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUd0RCxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQ3hCLENBQUM7SUFDSCxDQUFDO0lBRUQsa0JBQWtCLFFBQVE7UUFDeEIsR0FBRyxDQUFBLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQztZQUNuQyxHQUFHLENBQUEsQ0FBQyxJQUFJLE1BQU0sR0FBRyxDQUFDLEVBQUUsTUFBTSxHQUFHLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRSxDQUFDO2dCQUMvQyxJQUFJLFdBQVcsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBRXhDLEVBQUUsQ0FBQSxDQUFDLFdBQVcsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO29CQUV6QixJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxHQUFHLGdCQUFnQixDQUFDLEdBQUcsSUFBSSxDQUFDO29CQUN6RSxJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxHQUFHLGdCQUFnQixDQUFDLEdBQUcsSUFBSSxDQUFDO29CQUV6RSxNQUFNLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO3dCQUNwQixLQUFLLEtBQUs7NEJBQ1IsSUFBSSxLQUFLLEdBQUcsSUFBSSxZQUFZLENBQUM7NEJBQzdCLEtBQUssQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDOzRCQUMzQixLQUFLLENBQUMsT0FBTyxHQUFHLFVBQVUsQ0FBQzs0QkFDM0IsS0FBSyxDQUFDLENBQUMsR0FBRyxNQUFNLEdBQUcsSUFBSSxDQUFDOzRCQUN4QixLQUFLLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUM7NEJBQ3JCLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7NEJBQ3BCLEtBQUssQ0FBQzt3QkFFUixLQUFLLEdBQUc7NEJBQ04sSUFBSSxHQUFHLEdBQUcsSUFBSSxZQUFZLENBQUM7NEJBQzNCLEdBQUcsQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDOzRCQUN6QixHQUFHLENBQUMsT0FBTyxHQUFHLFVBQVUsQ0FBQzs0QkFDekIsR0FBRyxDQUFDLENBQUMsR0FBRyxNQUFNLEdBQUcsSUFBSSxDQUFDOzRCQUN0QixHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUM7NEJBQ25CLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7NEJBQ2xCLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7NEJBQ2hCLEtBQUssQ0FBQzt3QkFFUixLQUFLLElBQUk7NEJBQ1AsSUFBSSxJQUFJLEdBQUcsSUFBSSxZQUFZLENBQUM7NEJBQzVCLElBQUksQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDOzRCQUMxQixJQUFJLENBQUMsT0FBTyxHQUFHLFVBQVUsQ0FBQzs0QkFDMUIsSUFBSSxDQUFDLENBQUMsR0FBRyxNQUFNLEdBQUcsSUFBSSxDQUFDOzRCQUN2QixJQUFJLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUM7NEJBQ3BCLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7NEJBQ25CLEtBQUssQ0FBQzt3QkFFUixLQUFLLE1BQU07NEJBQ1QsTUFBTSxHQUFHLElBQUksWUFBWSxDQUFDOzRCQUMxQixNQUFNLENBQUMsT0FBTyxHQUFHLFVBQVUsQ0FBQzs0QkFDNUIsTUFBTSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUM7NEJBQzVCLE1BQU0sQ0FBQyxDQUFDLEdBQUcsTUFBTSxHQUFHLElBQUksQ0FBQzs0QkFDekIsTUFBTSxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDOzRCQUN0QixPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDOzRCQUNyQixLQUFLLENBQUM7d0JBRVIsS0FBSyxPQUFPOzRCQUNWLElBQUksT0FBTyxHQUFHLElBQUksS0FBSyxFQUFFLENBQUM7NEJBQzFCLE9BQU8sQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDOzRCQUM3QixPQUFPLENBQUMsT0FBTyxHQUFHLFVBQVUsQ0FBQzs0QkFDN0IsT0FBTyxDQUFDLENBQUMsR0FBRyxNQUFNLEdBQUcsSUFBSSxDQUFDOzRCQUMxQixPQUFPLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUM7NEJBRXZCLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQTs0QkFDeEIsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQzs0QkFDdkIsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQzs0QkFDdEIsS0FBSyxDQUFDO29CQUNWLENBQUM7Z0JBQ0gsQ0FBQztZQUNILENBQUM7UUFDSCxDQUFDO0lBQ0gsQ0FBQztJQUVELHlCQUF5QixPQUFPO1FBRTlCLE9BQU8sQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDO1FBQzdCLE9BQU8sQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztRQUdqQyxJQUFJLGFBQWEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDakQsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1FBSzlDLEVBQUUsQ0FBQSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xCLElBQUksVUFBVSxHQUFHLEdBQUcsQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDcEQsRUFBRSxDQUFBLENBQUMsVUFBVSxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLE9BQU8sQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMzQyxDQUFDO1FBQ0gsQ0FBQztRQUNELEVBQUUsQ0FBQSxDQUFDLFVBQVUsR0FBRyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6QixJQUFJLFVBQVUsR0FBRyxHQUFHLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ3BELEVBQUUsQ0FBQSxDQUFDLFVBQVUsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUN4QixPQUFPLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDN0MsQ0FBQztRQUNILENBQUM7UUFDRCxFQUFFLENBQUEsQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyQixJQUFJLGNBQWMsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3hELEVBQUUsQ0FBQSxDQUFDLGNBQWMsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUM1QixPQUFPLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDN0MsQ0FBQztRQUNILENBQUM7UUFDRCxFQUFFLENBQUEsQ0FBQyxhQUFhLEdBQUcsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0IsSUFBSSxlQUFlLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUN6RCxFQUFFLENBQUEsQ0FBQyxlQUFlLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDN0IsT0FBTyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlDLENBQUM7UUFDSCxDQUFDO1FBUUQsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUUzQyxJQUFJLGVBQWUsR0FDZixDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUM7bUJBQ2xELE9BQU8sQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRTNELElBQUksa0JBQWtCLEdBQ2xCLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQzttQkFDcEQsT0FBTyxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFJekQsRUFBRSxDQUFBLENBQUMsZUFBZSxJQUFJLGtCQUFrQjttQkFDeEMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFckMsRUFBRSxDQUFBLENBQUMsTUFBTSxLQUFLLElBQUksSUFBSSxPQUFPLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQzVDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUNoQyxDQUFDO2dCQUlELEVBQUUsQ0FBQSxDQUFDLE1BQU0sS0FBSyxJQUFJLElBQUksT0FBTyxDQUFDLFNBQVMsS0FBSyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztvQkFDNUQsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDM0UsT0FBTyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUMvRCxDQUFDO2dCQUdFLE1BQU0sQ0FBQSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO29CQUN6QixLQUFLLE9BQU8sQ0FBQyxLQUFLO3dCQUNoQixPQUFPLENBQUMsRUFBRSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7d0JBQzNCLE9BQU8sQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO3dCQUNmLEtBQUssQ0FBQztvQkFFUixLQUFLLE9BQU8sQ0FBQyxJQUFJO3dCQUNmLE9BQU8sQ0FBQyxFQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO3dCQUM1QixPQUFPLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQzt3QkFDZixLQUFLLENBQUM7b0JBRVIsS0FBSyxPQUFPLENBQUMsRUFBRTt3QkFDYixPQUFPLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQzt3QkFDZixPQUFPLENBQUMsRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQzt3QkFDNUIsS0FBSyxDQUFDO29CQUVSLEtBQUssT0FBTyxDQUFDLElBQUk7d0JBQ2YsT0FBTyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7d0JBQ2YsT0FBTyxDQUFDLEVBQUUsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO2dCQUMvQixDQUFDO1lBQ0gsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0lBRUQsOEJBQThCLE9BQU87UUFDbkMsSUFBSSxnQkFBZ0IsR0FBRyxTQUFTLENBQUM7UUFHakMsSUFBSSxFQUFFLEdBQUcsTUFBTSxDQUFDLE9BQU8sRUFBRSxHQUFHLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUM5QyxJQUFJLEVBQUUsR0FBRyxNQUFNLENBQUMsT0FBTyxFQUFFLEdBQUcsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRzlDLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFaEMsRUFBRSxDQUFBLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ1gsZ0JBQWdCLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQztZQUN4QyxDQUFDO1lBQ0QsSUFBSSxDQUFDLENBQUM7Z0JBQ0osZ0JBQWdCLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQztZQUN6QyxDQUFDO1FBQ0gsQ0FBQztRQUVELElBQUksQ0FBQyxDQUFDO1lBRUosRUFBRSxDQUFBLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ1gsZ0JBQWdCLEdBQUcsYUFBYSxDQUFDLEVBQUUsQ0FBQztZQUN0QyxDQUFDO1lBQ0QsSUFBSSxDQUFDLENBQUM7Z0JBQ0osZ0JBQWdCLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQztZQUN4QyxDQUFDO1FBQ0gsQ0FBQztRQUdELEdBQUcsQ0FBQSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUN2RCxFQUFFLENBQUEsQ0FBQyxnQkFBZ0IsS0FBSyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFbkQsT0FBTyxDQUFDLFNBQVMsR0FBRyxnQkFBZ0IsQ0FBQztZQUN2QyxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRDtRQUVFLEVBQUUsQ0FBQSxDQUFDLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDdkIsTUFBTSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNqQixDQUFDO1FBRUQsRUFBRSxDQUFBLENBQUMsUUFBUSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUN2QixNQUFNLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNoQixDQUFDO1FBRUQsRUFBRSxDQUFBLENBQUMsUUFBUSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUMxQixNQUFNLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2pCLENBQUM7UUFFRCxFQUFFLENBQUEsQ0FBQyxTQUFTLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQzFCLE1BQU0sQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLENBQUM7UUFHRCxFQUFFLENBQUEsQ0FBQyxDQUFDLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDeEIsTUFBTSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDaEIsQ0FBQztRQUNELEVBQUUsQ0FBQSxDQUFDLENBQUMsUUFBUSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUMzQixNQUFNLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNoQixDQUFDO1FBR0QsTUFBTSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ3BGLE1BQU0sQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUd0RixHQUFHLENBQUEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNyQyxjQUFjLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25DLENBQUM7UUFHRCxHQUFHLENBQUEsQ0FBQyxJQUFJLENBQUMsR0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFFLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNyQyxJQUFJLE9BQU8sR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDMUIsRUFBRSxDQUFBLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDckMsU0FBUyxHQUFHLElBQUksQ0FBQztZQUNuQixDQUFDO1FBQ0gsQ0FBQztRQUdELEdBQUcsQ0FBQSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ3hDLElBQUksT0FBTyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUcxQixPQUFPLENBQUMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDeEIsT0FBTyxDQUFDLENBQUMsSUFBSSxPQUFPLENBQUMsRUFBRSxDQUFDO1lBR3hCLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksS0FBSyxDQUFDO21CQUNsQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFdEMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzNCLENBQUM7UUFDSCxDQUFDO0lBQ0gsQ0FBQztJQUVEO1FBQ0UsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2xCLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQzlCLENBQUM7SUFFRDtRQUNFLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUc1RCxFQUFFLENBQUEsQ0FBQyxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDeEIsR0FBRyxDQUFBLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzFDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDeEIsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7b0JBQ2YsY0FBYyxDQUFDLFNBQVMsQ0FFckIsS0FBSyxFQUNMLE1BQU0sQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU8sRUFDOUIsTUFBTSxDQUFDLFdBQVcsRUFBRSxNQUFNLENBQUMsWUFBWSxFQUN2QyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFDMUMsTUFBTSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsTUFBTSxDQUM3QixDQUFDO2dCQUNKLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7QUFFRCxDQUFDLEVBQUUsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7XHJcblxyXG4vL1RoZSBjYW52YXNcclxubGV0IGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJjYW52YXNcIik7XHJcbmxldCBkcmF3aW5nU3VyZmFjZSA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcblxyXG4vL1RoZSBnYW1lIG1hcFxyXG5sZXQgbWFwID1cclxuW1xyXG4gIFsxLDEsMSwxLDEsMSwxLDEsMSwxLDFdLFxyXG4gIFsxLDEsMSwxLDEsMSwxLDEsMSwxLDFdLFxyXG4gIFsxLDEsMiwyLDIsMSwyLDEsMiwxLDFdLFxyXG4gIFsxLDEsMSwyLDEsMSwxLDEsMSwxLDFdLFxyXG4gIFsxLDEsMSwxLDEsMiwxLDEsMiwxLDFdLFxyXG4gIFsxLDEsMiwxLDIsMiwxLDIsMiwxLDFdLFxyXG4gIFsxLDEsMSwxLDEsMSwyLDEsMSwxLDFdLFxyXG4gIFsxLDEsMSwxLDEsMSwxLDEsMSwxLDFdXHJcbl07XHJcbi8vU2h1ZmZsZSB0aGUgZ2FtZSBtYXBcclxuZnVuY3Rpb24gc2h1ZmZsZShhcnJheSkge1xyXG5cclxuICAgIGxldCBjb3VudGVyID0gYXJyYXkubGVuZ3RoO1xyXG5cclxuICAgIC8vIFdoaWxlIHRoZXJlIGFyZSBlbGVtZW50cyBpbiB0aGUgYXJyYXlcclxuICAgIHdoaWxlIChjb3VudGVyID4gMCkge1xyXG5cclxuICAgICAgICAvLyBQaWNrIGEgcmFuZG9tIGluZGV4XHJcbiAgICAgICAgbGV0IGluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY291bnRlcik7XHJcblxyXG4gICAgICAgIC8vIERlY3JlYXNlIGNvdW50ZXIgYnkgMVxyXG4gICAgICAgIGNvdW50ZXItLTtcclxuXHJcbiAgICAgICAgLy8gQW5kIHN3YXAgdGhlIGxhc3QgZWxlbWVudCB3aXRoIGl0XHJcbiAgICAgICAgbGV0IHRlbXAgPSBhcnJheVtjb3VudGVyXTtcclxuICAgICAgICBhcnJheVtjb3VudGVyXSA9IGFycmF5W2luZGV4XTtcclxuICAgICAgICBhcnJheVtpbmRleF0gPSB0ZW1wO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBhcnJheTtcclxufVxyXG5cclxuLy9UaGUgZ2FtZSBvYmplY3RzIG1hcFxyXG4vL05vdGU6IG1ha2Ugc3VyZSBtb25zdGVycyBhcmUgYXQgYW4gaW50ZXJzZWN0aW9uIHNvIHRoYXRcclxuLy9jaGFuZ2VEaXJlY3Rpb24gd2lsbCBhc3NpZ24gdGhlbSB0aGVpciBzdGFydGluZyB2ZWxvY2l0eVxyXG5cclxubGV0IGdhbWVPYmplY3RzID1cclxuW1xyXG4gIFswLDAsMCwwLDAsMCwwLDAsMCwwLDBdLFxyXG4gIFswLDAsMCwwLDAsMCwwLDAsMCwzLDBdLFxyXG4gIFswLDMsMCwwLDAsMCwwLDAsMCwwLDBdLFxyXG4gIFswLDAsMCwwLDAsNCwwLDAsMCwwLDBdLFxyXG4gIFswLDAsMywwLDAsMCwwLDAsMCwwLDBdLFxyXG4gIFswLDAsMCwwLDAsMCwwLDAsMCwwLDBdLFxyXG4gIFswLDAsMCwwLDAsMCwwLDAsMCwwLDBdLFxyXG4gIFswLDAsMCwwLDAsMCwwLDAsMCwwLDBdXHJcbl07XHJcblxyXG4vL01hcCBjb2RlXHJcbmNvbnN0IEVNUFRZID0gMDtcclxuY29uc3QgRkxPT1IgPSAxO1xyXG5jb25zdCBCT1ggPSAyO1xyXG5jb25zdCBNT05TVEVSID0gMztcclxuY29uc3QgUExBWUVSID0gNDtcclxuY29uc3QgV0FMTCA9IDU7XHJcblxyXG4vL1RoZSBzaXplIG9mIGVhY2ggdGlsZSBjZWxsXHJcbmxldCBTSVpFID0gNjQ7XHJcblxyXG4vL1Nwcml0ZXMgd2UgbmVlZCB0byBhY2Nlc3MgYnkgbmFtZVxyXG5sZXQgcGxheWVyID0gbnVsbDtcclxuXHJcbi8vVGhlIG51bWJlciBvZiByb3dzIGFuZCBjb2x1bW5zXHJcbmxldCBST1dTID0gbWFwLmxlbmd0aDtcclxubGV0IENPTFVNTlMgPSBtYXBbMF0ubGVuZ3RoO1xyXG5cclxuLy9UaGUgbnVtYmVyIG9mIGNvbHVtbnMgb24gdGhlIHRpbGVzaGVldFxyXG5sZXQgdGlsZXNoZWV0Q29sdW1ucyA9IDM7XHJcblxyXG4vL0FycmF5cyB0byBzdG9yZSB0aGUgZ2FtZSBvYmplY3RzXHJcbmxldCBzcHJpdGVzID0gW107XHJcbmxldCBtb25zdGVycyA9IFtdO1xyXG5sZXQgYm94ZXMgPSBbXTtcclxuXHJcbmxldCBhc3NldHNUb0xvYWQgPSBbXTtcclxubGV0IGFzc2V0c0xvYWRlZCA9IDA7XHJcblxyXG4vL0xvYWQgdGhlIHRpbGVzaGVldCBpbWFnZVxyXG5sZXQgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgbG9hZEhhbmRsZXIsIGZhbHNlKTtcclxuaW1hZ2Uuc3JjID0gXCJpbWFnZXMvdGlsZXNoZWV0LnBuZ1wiO1xyXG5hc3NldHNUb0xvYWQucHVzaChpbWFnZSk7XHJcblxyXG4vL0dhbWUgdmFyaWFibGVzXHJcblxyXG4vL0dhbWUgc3RhdGVzXHJcbmxldCBMT0FESU5HID0gMDtcclxubGV0IEJVSUxEX01BUCA9IDE7XHJcbmxldCBQTEFZSU5HID0gMjtcclxubGV0IE9WRVIgPSAzO1xyXG5sZXQgZ2FtZVN0YXRlID0gTE9BRElORztcclxuXHJcbi8vQXJyb3cga2V5IGNvZGVzXHJcbmNvbnN0IFVQID0gMzg7XHJcbmNvbnN0IERPV04gPSA0MDtcclxuY29uc3QgUklHSFQgPSAzOTtcclxuY29uc3QgTEVGVCA9IDM3O1xyXG5cclxuLy9EaXJlY3Rpb25zXHJcbmxldCBtb3ZlVXAgPSBmYWxzZTtcclxubGV0IG1vdmVEb3duID0gZmFsc2U7XHJcbmxldCBtb3ZlUmlnaHQgPSBmYWxzZTtcclxubGV0IG1vdmVMZWZ0ID0gZmFsc2U7XHJcblxyXG4vL0FkZCBrZXlib2FyZCBsaXN0ZW5lcnNcclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgc3dpdGNoKGV2ZW50LmtleUNvZGUpIHtcclxuICAgIGNhc2UgVVA6XHJcbiAgICAgIG1vdmVVcCA9IHRydWU7XHJcbiAgICAgIGJyZWFrO1xyXG5cclxuICAgIGNhc2UgRE9XTjpcclxuICAgICAgbW92ZURvd24gPSB0cnVlO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlIExFRlQ6XHJcbiAgICAgIG1vdmVMZWZ0ID0gdHJ1ZTtcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgY2FzZSBSSUdIVDpcclxuICAgICAgbW92ZVJpZ2h0ID0gdHJ1ZTtcclxuICAgICAgYnJlYWs7XHJcbiAgfVxyXG59LCBmYWxzZSk7XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgc3dpdGNoKGV2ZW50LmtleUNvZGUpIHtcclxuICAgIGNhc2UgVVA6XHJcbiAgICAgIG1vdmVVcCA9IGZhbHNlO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlIERPV046XHJcbiAgICAgIG1vdmVEb3duID0gZmFsc2U7XHJcbiAgICAgIGJyZWFrO1xyXG5cclxuICAgIGNhc2UgTEVGVDpcclxuICAgICAgbW92ZUxlZnQgPSBmYWxzZTtcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgY2FzZSBSSUdIVDpcclxuICAgICAgbW92ZVJpZ2h0ID0gZmFsc2U7XHJcbiAgICAgIGJyZWFrO1xyXG4gIH1cclxufSwgZmFsc2UpO1xyXG5cclxuLy9TdGFydCB0aGUgZ2FtZSBhbmltYXRpb24gbG9vcFxyXG51cGRhdGUoKTtcclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcclxuICAvL1RoZSBhbmltYXRpb24gbG9vcFxyXG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZSh1cGRhdGUsIGNhbnZhcyk7XHJcblxyXG4gIC8vQ2hhbmdlIHdoYXQgdGhlIGdhbWUgaXMgZG9pbmcgYmFzZWQgb24gdGhlIGdhbWUgc3RhdGVcclxuICBzd2l0Y2goZ2FtZVN0YXRlKSB7XHJcbiAgICBjYXNlIExPQURJTkc6XHJcbiAgICAgIGNvbnNvbGUubG9nKFwibG9hZGluZy4uLlwiKTtcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgY2FzZSBCVUlMRF9NQVA6XHJcbiAgICAgIHNodWZmbGUobWFwKTtcclxuICAgICAgYnVpbGRNYXAobWFwKTtcclxuICAgICAgYnVpbGRNYXAoZ2FtZU9iamVjdHMpO1xyXG4gICAgICAvL2NyZWF0ZU90aGVyT2JqZWN0cygpO1xyXG4gICAgICBnYW1lU3RhdGUgPSBQTEFZSU5HO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlIFBMQVlJTkc6XHJcbiAgICAgIHBsYXlHYW1lKCk7XHJcbiAgICAgIGJyZWFrO1xyXG5cclxuICAgIGNhc2UgT1ZFUjpcclxuICAgICAgZW5kR2FtZSgpO1xyXG4gICAgICBicmVhaztcclxuICB9XHJcblxyXG4gIC8vUmVuZGVyIHRoZSBnYW1lXHJcbiAgcmVuZGVyKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGxvYWRIYW5kbGVyKCkge1xyXG4gIGFzc2V0c0xvYWRlZCsrO1xyXG4gIGlmKGFzc2V0c0xvYWRlZCA9PT0gYXNzZXRzVG9Mb2FkLmxlbmd0aCkge1xyXG4gICAgLy9SZW1vdmUgdGhlIGxvYWQgaGFuZGxlcnNcclxuICAgIGltYWdlLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGxvYWRIYW5kbGVyLCBmYWxzZSk7XHJcblxyXG4gICAgLy9CdWlsZCB0aGUgbWFwXHJcbiAgICBnYW1lU3RhdGUgPSBCVUlMRF9NQVA7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBidWlsZE1hcChsZXZlbE1hcCkge1xyXG4gIGZvcihsZXQgcm93ID0gMDsgcm93IDwgUk9XUzsgcm93KyspIHtcclxuICAgIGZvcihsZXQgY29sdW1uID0gMDsgY29sdW1uIDwgQ09MVU1OUzsgY29sdW1uKyspIHtcclxuICAgICAgbGV0IGN1cnJlbnRUaWxlID0gbGV2ZWxNYXBbcm93XVtjb2x1bW5dO1xyXG5cclxuICAgICAgaWYoY3VycmVudFRpbGUgIT09IEVNUFRZKSB7XHJcbiAgICAgICAgLy9GaW5kIHRoZSB0aWxlJ3MgeCBhbmQgeSBwb3NpdGlvbiBvbiB0aGUgdGlsZSBzaGVldFxyXG4gICAgICAgIGxldCB0aWxlc2hlZXRYID0gTWF0aC5mbG9vcigoY3VycmVudFRpbGUgLSAxKSAlIHRpbGVzaGVldENvbHVtbnMpICogU0laRTtcclxuICAgICAgICBsZXQgdGlsZXNoZWV0WSA9IE1hdGguZmxvb3IoKGN1cnJlbnRUaWxlIC0gMSkgLyB0aWxlc2hlZXRDb2x1bW5zKSAqIFNJWkU7XHJcblxyXG4gICAgICAgIHN3aXRjaCAoY3VycmVudFRpbGUpIHtcclxuICAgICAgICAgIGNhc2UgRkxPT1I6XHJcbiAgICAgICAgICAgIGxldCBmbG9vciA9IG5ldyBTcHJpdGVPYmplY3Q7XHJcbiAgICAgICAgICAgIGZsb29yLnNvdXJjZVggPSB0aWxlc2hlZXRYO1xyXG4gICAgICAgICAgICBmbG9vci5zb3VyY2VZID0gdGlsZXNoZWV0WTtcclxuICAgICAgICAgICAgZmxvb3IueCA9IGNvbHVtbiAqIFNJWkU7XHJcbiAgICAgICAgICAgIGZsb29yLnkgPSByb3cgKiBTSVpFO1xyXG4gICAgICAgICAgICBzcHJpdGVzLnB1c2goZmxvb3IpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICBjYXNlIEJPWDpcclxuICAgICAgICAgICAgbGV0IGJveCA9IG5ldyBTcHJpdGVPYmplY3Q7XHJcbiAgICAgICAgICAgIGJveC5zb3VyY2VYID0gdGlsZXNoZWV0WDtcclxuICAgICAgICAgICAgYm94LnNvdXJjZVkgPSB0aWxlc2hlZXRZO1xyXG4gICAgICAgICAgICBib3gueCA9IGNvbHVtbiAqIFNJWkU7XHJcbiAgICAgICAgICAgIGJveC55ID0gcm93ICogU0laRTtcclxuICAgICAgICAgICAgc3ByaXRlcy5wdXNoKGJveCk7XHJcbiAgICAgICAgICAgIGJveGVzLnB1c2goYm94KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgY2FzZSBXQUxMOlxyXG4gICAgICAgICAgICBsZXQgd2FsbCA9IG5ldyBTcHJpdGVPYmplY3Q7XHJcbiAgICAgICAgICAgIHdhbGwuc291cmNlWCA9IHRpbGVzaGVldFg7XHJcbiAgICAgICAgICAgIHdhbGwuc291cmNlWSA9IHRpbGVzaGVldFk7XHJcbiAgICAgICAgICAgIHdhbGwueCA9IGNvbHVtbiAqIFNJWkU7XHJcbiAgICAgICAgICAgIHdhbGwueSA9IHJvdyAqIFNJWkU7XHJcbiAgICAgICAgICAgIHNwcml0ZXMucHVzaCh3YWxsKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgY2FzZSBQTEFZRVI6XHJcbiAgICAgICAgICAgIHBsYXllciA9IG5ldyBTcHJpdGVPYmplY3Q7XHJcbiAgICAgICAgICAgIHBsYXllci5zb3VyY2VYID0gdGlsZXNoZWV0WDtcclxuICAgICAgICAgICAgcGxheWVyLnNvdXJjZVkgPSB0aWxlc2hlZXRZO1xyXG4gICAgICAgICAgICBwbGF5ZXIueCA9IGNvbHVtbiAqIFNJWkU7XHJcbiAgICAgICAgICAgIHBsYXllci55ID0gcm93ICogU0laRTtcclxuICAgICAgICAgICAgc3ByaXRlcy5wdXNoKHBsYXllcik7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgIGNhc2UgTU9OU1RFUjpcclxuICAgICAgICAgICAgbGV0IG1vbnN0ZXIgPSBuZXcgRW5lbXkoKTtcclxuICAgICAgICAgICAgbW9uc3Rlci5zb3VyY2VYID0gdGlsZXNoZWV0WDtcclxuICAgICAgICAgICAgbW9uc3Rlci5zb3VyY2VZID0gdGlsZXNoZWV0WTtcclxuICAgICAgICAgICAgbW9uc3Rlci54ID0gY29sdW1uICogU0laRTtcclxuICAgICAgICAgICAgbW9uc3Rlci55ID0gcm93ICogU0laRTtcclxuICAgICAgICAgICAgLy9NYWtlIHRoZSBtb25zdGVyIGNob29zZSBhIHJhbmRvbSBzdGFydCBkaXJlY3Rpb25cclxuICAgICAgICAgICAgY2hhbmdlRGlyZWN0aW9uKG1vbnN0ZXIpXHJcbiAgICAgICAgICAgIG1vbnN0ZXJzLnB1c2gobW9uc3Rlcik7XHJcbiAgICAgICAgICAgIHNwcml0ZXMucHVzaChtb25zdGVyKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjaGFuZ2VEaXJlY3Rpb24obW9uc3Rlcikge1xyXG4gIC8vQ2xlYXIgYW55IHByZXZpb3VzIGRpcmVjdGlvbiB0aGUgbW9uc3RlciBoYXMgY2hvc2VuXHJcbiAgbW9uc3Rlci52YWxpZERpcmVjdGlvbnMgPSBbXTtcclxuICBtb25zdGVyLmRpcmVjdGlvbiA9IG1vbnN0ZXIuTk9ORTtcclxuXHJcbiAgLy9GaW5kIHRoZSBtb25zdGVyJ3MgY29sdW1uIGFuZCByb3cgaW4gdGhlIGFycmF5XHJcbiAgbGV0IG1vbnN0ZXJDb2x1bW4gPSBNYXRoLmZsb29yKG1vbnN0ZXIueCAvIFNJWkUpO1xyXG4gIGxldCBtb25zdGVyUm93ID0gTWF0aC5mbG9vcihtb25zdGVyLnkgLyBTSVpFKTtcclxuXHJcbiAgLy9GaW5kIG91dCB3aGF0IGtpbmRzIG9mIHRoaW5ncyBhcmUgaW4gdGhlIG1hcCBjZWxsc1xyXG4gIC8vdGhhdCBzdXJyb3VuZCB0aGUgbW9uc3Rlci4gSWYgdGhlIGNlbGxzIGNvbnRhaW4gYSBGTE9PUiBjZWxsLFxyXG4gIC8vcHVzaCB0aGUgY29ycmVzcG9uZGluZyBkaXJlY3Rpb24gaW50byB0aGUgdmFsaWREaXJlY3Rpb25zIGFycmF5XHJcbiAgaWYobW9uc3RlclJvdyA+IDApIHtcclxuICAgIGxldCB0aGluZ0Fib3ZlID0gbWFwW21vbnN0ZXJSb3cgLSAxXVttb25zdGVyQ29sdW1uXTtcclxuICAgIGlmKHRoaW5nQWJvdmUgPT09IEZMT09SKSB7XHJcbiAgICAgIG1vbnN0ZXIudmFsaWREaXJlY3Rpb25zLnB1c2gobW9uc3Rlci5VUCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGlmKG1vbnN0ZXJSb3cgPCBST1dTIC0gMSkge1xyXG4gICAgbGV0IHRoaW5nQmVsb3cgPSBtYXBbbW9uc3RlclJvdyArIDFdW21vbnN0ZXJDb2x1bW5dO1xyXG4gICAgaWYodGhpbmdCZWxvdyA9PT0gRkxPT1IpIHtcclxuICAgICAgbW9uc3Rlci52YWxpZERpcmVjdGlvbnMucHVzaChtb25zdGVyLkRPV04pO1xyXG4gICAgfVxyXG4gIH1cclxuICBpZihtb25zdGVyQ29sdW1uID4gMCkge1xyXG4gICAgbGV0IHRoaW5nVG9UaGVMZWZ0ID0gbWFwW21vbnN0ZXJSb3ddW21vbnN0ZXJDb2x1bW4gLSAxXTtcclxuICAgIGlmKHRoaW5nVG9UaGVMZWZ0ID09PSBGTE9PUikge1xyXG4gICAgICBtb25zdGVyLnZhbGlkRGlyZWN0aW9ucy5wdXNoKG1vbnN0ZXIuTEVGVCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGlmKG1vbnN0ZXJDb2x1bW4gPCBDT0xVTU5TIC0gMSkge1xyXG4gICAgbGV0IHRoaW5nVG9UaGVSaWdodCA9IG1hcFttb25zdGVyUm93XVttb25zdGVyQ29sdW1uICsgMV07XHJcbiAgICBpZih0aGluZ1RvVGhlUmlnaHQgPT09IEZMT09SKSB7XHJcbiAgICAgIG1vbnN0ZXIudmFsaWREaXJlY3Rpb25zLnB1c2gobW9uc3Rlci5SSUdIVCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvL1RoZSBtb25zdGVyJ3MgdmFsaWREaXJlY3Rpb25zIGFycmF5IG5vdyBjb250YWlucyAwIHRvIDQgZGlyZWN0aW9ucyB0aGF0IHRoZVxyXG4gIC8vY29udGFpbiBGTE9PUiBjZWxscy4gV2hpY2ggb2YgdGhvc2UgZGlyZWN0aW9ucyB3aWxsIHRoZSBtb25zdGVyXHJcbiAgLy9jaG9vc2UgdG8gbW92ZSBpbj9cclxuXHJcbiAgLy9JZiBhIHZhbGlkIGRpcmVjdGlvbiB3YXMgZm91bmQsIEZpZ3VyZSBvdXQgaWYgdGhlIG1vbnN0ZXIgaXMgYXQgYW5cclxuICAvL21hemUgcGFzc2FnZSBpbnRlcnNlY3Rpb24uXHJcbiAgaWYobW9uc3Rlci52YWxpZERpcmVjdGlvbnMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAvL0ZpbmQgb3V0IGlmIHRoZSBtb25zdGVyIGlzIGF0IGFuIGludGVyc2VjdGlvblxyXG5cdGxldCB1cE9yRG93blBhc3NhZ2VcclxuXHQgID0gKG1vbnN0ZXIudmFsaWREaXJlY3Rpb25zLmluZGV4T2YobW9uc3Rlci5VUCkgIT09IC0xXHJcblx0ICB8fCBtb25zdGVyLnZhbGlkRGlyZWN0aW9ucy5pbmRleE9mKG1vbnN0ZXIuRE9XTikgIT09IC0xKTtcclxuXHJcblx0bGV0IGxlZnRPclJpZ2h0UGFzc2FnZVxyXG5cdCAgPSAobW9uc3Rlci52YWxpZERpcmVjdGlvbnMuaW5kZXhPZihtb25zdGVyLkxFRlQpICE9PSAtMVxyXG5cdCAgfHwgbW9uc3Rlci52YWxpZERpcmVjdGlvbnMuaW5kZXhPZihtb25zdGVyLlJJR0hUKSAhPT0gLTEpO1xyXG5cclxuICAgIC8vQ2hhbmdlIHRoZSBtb25zdGVyJ3MgZGlyZWN0aW9uIGlmIGl0J3MgYXQgYW4gaW50ZXJzZWN0aW9uIG9yXHJcbiAgICAvL2luIGEgY3VsLWRlLXNhYyAoZGVhZC1lbmQpXHJcbiAgICBpZih1cE9yRG93blBhc3NhZ2UgJiYgbGVmdE9yUmlnaHRQYXNzYWdlXHJcblx0fHwgbW9uc3Rlci52YWxpZERpcmVjdGlvbnMubGVuZ3RoID09PSAxKSB7XHJcblx0ICAvL09wdGlvbmFsbHkgZmluZCB0aGUgY2xvc2VzdCBkaXN0YW5jZSB0byB0aGUgcGxheWVyXHJcbiAgICAgIGlmKHBsYXllciAhPT0gbnVsbCAmJiBtb25zdGVyLmh1bnQgPT09IHRydWUpIHtcclxuICAgICAgICBmaW5kQ2xvc2VzdERpcmVjdGlvbihtb25zdGVyKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy9Bc3NpZ24gYSByYW5kb20gdmFsaWREaXJlY3Rpb24gaWYgdGhlIHBsYXllciBvYmplY3QgZG9lc24ndCBleGlzdCBpbiB0aGUgZ2FtZVxyXG4gICAgICAvL29yIGEgdmFsaWREaXJlY3Rpb24gd2Fzbid0IGZvdW5kIHRoYXQgYnJpbmdzIHRoZSBtb25zdGVyIGNsb3NlciB0byB0aGUgcGxheWVyXHJcbiAgICAgIGlmKHBsYXllciA9PT0gbnVsbCB8fCBtb25zdGVyLmRpcmVjdGlvbiA9PT0gbW9uc3Rlci5OT05FKSB7XHJcblx0ICAgIGxldCByYW5kb21OdW1iZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtb25zdGVyLnZhbGlkRGlyZWN0aW9ucy5sZW5ndGgpO1xyXG4gICAgICAgIG1vbnN0ZXIuZGlyZWN0aW9uID0gbW9uc3Rlci52YWxpZERpcmVjdGlvbnNbcmFuZG9tTnVtYmVyXTtcclxuXHQgIH1cclxuXHJcbiAgICAgIC8vQ2hvb3NlIHRoZSBtb25zdGVyJ3MgZmluYWwgZGlyZWN0aW9uXHJcbiAgICAgIHN3aXRjaChtb25zdGVyLmRpcmVjdGlvbikge1xyXG4gICAgICAgIGNhc2UgbW9uc3Rlci5SSUdIVDpcclxuICAgICAgICAgIG1vbnN0ZXIudnggPSBtb25zdGVyLnNwZWVkO1xyXG4gICAgICAgICAgbW9uc3Rlci52eSA9IDA7XHJcbiAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSBtb25zdGVyLkxFRlQ6XHJcbiAgICAgICAgICBtb25zdGVyLnZ4ID0gLW1vbnN0ZXIuc3BlZWQ7XHJcbiAgICAgICAgICBtb25zdGVyLnZ5ID0gMDtcclxuICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlIG1vbnN0ZXIuVVA6XHJcbiAgICAgICAgICBtb25zdGVyLnZ4ID0gMDtcclxuICAgICAgICAgIG1vbnN0ZXIudnkgPSAtbW9uc3Rlci5zcGVlZDtcclxuICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlIG1vbnN0ZXIuRE9XTjpcclxuICAgICAgICAgIG1vbnN0ZXIudnggPSAwO1xyXG4gICAgICAgICAgbW9uc3Rlci52eSA9IG1vbnN0ZXIuc3BlZWQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZpbmRDbG9zZXN0RGlyZWN0aW9uKG1vbnN0ZXIpIHtcclxuICBsZXQgY2xvc2VzdERpcmVjdGlvbiA9IHVuZGVmaW5lZDtcclxuXHJcbiAgLy9GaW5kIHRoZSBkaXN0YW5jZSBiZXR3ZWVuIHRoZSBtb25zdGVyIGFuZCB0aGUgcGxheWVyXHJcbiAgbGV0IHZ4ID0gcGxheWVyLmNlbnRlclgoKSAtIG1vbnN0ZXIuY2VudGVyWCgpO1xyXG4gIGxldCB2eSA9IHBsYXllci5jZW50ZXJZKCkgLSBtb25zdGVyLmNlbnRlclkoKTtcclxuXHJcbiAgLy9JZiB0aGUgZGlzdGFuY2UgaXMgZ3JlYXRlciBvbiB0aGUgeCBheGlzLi4uXHJcbiAgaWYoTWF0aC5hYnModngpID49IE1hdGguYWJzKHZ5KSkge1xyXG4gICAgLy9UcnkgbGVmdCBhbmQgcmlnaHRcclxuICAgIGlmKHZ4IDw9IDApIHtcclxuICAgICAgY2xvc2VzdERpcmVjdGlvbiA9IG1vbnN0ZXJPYmplY3QuTEVGVDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjbG9zZXN0RGlyZWN0aW9uID0gbW9uc3Rlck9iamVjdC5SSUdIVDtcclxuICAgIH1cclxuICB9XHJcbiAgLy9JZiB0aGUgZGlzdGFuY2UgaXMgZ3JlYXRlciBvbiB0aGUgeSBheGlzLi4uXHJcbiAgZWxzZSB7XHJcbiAgICAvL1RyeSB1cCBhbmQgZG93blxyXG4gICAgaWYodnkgPD0gMCkge1xyXG4gICAgICBjbG9zZXN0RGlyZWN0aW9uID0gbW9uc3Rlck9iamVjdC5VUDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjbG9zZXN0RGlyZWN0aW9uID0gbW9uc3Rlck9iamVjdC5ET1dOO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy9GaW5kIG91dCBpZiB0aGUgY2xvc2VzdERpcmVjdGlvbiBpcyBvbmUgb2YgdGhlIHZhbGlkRGlyZWN0aW9uc1xyXG4gIGZvcihsZXQgaSA9IDA7IGkgPCBtb25zdGVyLnZhbGlkRGlyZWN0aW9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgaWYoY2xvc2VzdERpcmVjdGlvbiA9PT0gbW9uc3Rlci52YWxpZERpcmVjdGlvbnNbaV0pIHtcclxuICAgICAgLy9JZiBpdCwgYXNzaWduIHRoZSBjbG9zZXN0RGlyZWN0aW9uIHRvIHRoZSBtb25zdGVyJ3MgZGlyZWN0aW9uXHJcbiAgICAgIG1vbnN0ZXIuZGlyZWN0aW9uID0gY2xvc2VzdERpcmVjdGlvbjtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBsYXlHYW1lKCkge1xyXG4gIC8vVXBcclxuICBpZihtb3ZlVXAgJiYgIW1vdmVEb3duKSB7XHJcbiAgICBwbGF5ZXIudnkgPSAtNDtcclxuICB9XHJcbiAgLy9Eb3duXHJcbiAgaWYobW92ZURvd24gJiYgIW1vdmVVcCkge1xyXG4gICAgcGxheWVyLnZ5ID0gNDtcclxuICB9XHJcbiAgLy9MZWZ0XHJcbiAgaWYobW92ZUxlZnQgJiYgIW1vdmVSaWdodCkge1xyXG4gICAgcGxheWVyLnZ4ID0gLTQ7XHJcbiAgfVxyXG4gIC8vUmlnaHRcclxuICBpZihtb3ZlUmlnaHQgJiYgIW1vdmVMZWZ0KSB7XHJcbiAgICBwbGF5ZXIudnggPSA0O1xyXG4gIH1cclxuXHJcbiAgLy9TZXQgdGhlIHBsYXllcidzIHZlbG9jaXR5IHRvIHplcm8gaWYgbm9uZSBvZiB0aGUga2V5cyBhcmUgYmVpbmcgcHJlc3NlZFxyXG4gIGlmKCFtb3ZlVXAgJiYgIW1vdmVEb3duKSB7XHJcbiAgICBwbGF5ZXIudnkgPSAwO1xyXG4gIH1cclxuICBpZighbW92ZUxlZnQgJiYgIW1vdmVSaWdodCkge1xyXG4gICAgcGxheWVyLnZ4ID0gMDtcclxuICB9XHJcblxyXG4gIC8vTW92ZSB0aGUgcGxheWVyIGFuZCBrZWVwIGl0IGluc2lkZSB0aGUgc2NyZWVuIGJvdW5kYXJpZXNcclxuICBwbGF5ZXIueCA9IE1hdGgubWF4KDAsIE1hdGgubWluKHBsYXllci54ICsgcGxheWVyLnZ4LCBjYW52YXMud2lkdGggLSBwbGF5ZXIud2lkdGgpKTtcclxuICBwbGF5ZXIueSA9IE1hdGgubWF4KDAsIE1hdGgubWluKHBsYXllci55ICsgcGxheWVyLnZ5LCBjYW52YXMuaGVpZ2h0IC0gcGxheWVyLmhlaWdodCkpO1xyXG5cclxuICAvL0NoZWNrIGZvciBjb2xsaXNpb25zIGJldHdlZW4gdGhlIHBsYXllciBhbmQgdGhlIGJveGVzXHJcbiAgZm9yKGxldCBpID0gMDsgaSA8IGJveGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICBibG9ja1JlY3RhbmdsZShwbGF5ZXIsIGJveGVzW2ldKTtcclxuICB9XHJcblxyXG4gIC8vQ2hlY2sgZm9yIGNvbGxpc2lvbnMgd2l0aCBtb25zdGVyc1xyXG4gIGZvcihsZXQgaT0wOyBpPCBtb25zdGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgbGV0IG1vbnN0ZXIgPSBtb25zdGVyc1tpXTtcclxuICAgIGlmKGhpdFRlc3RSZWN0YW5nbGUocGxheWVyLCBtb25zdGVyKSkge1xyXG4gICAgICBnYW1lU3RhdGUgPSBPVkVSO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy9UaGUgbW9uc3RlcnNcclxuICBmb3IobGV0IGkgPSAwOyBpIDwgbW9uc3RlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgIGxldCBtb25zdGVyID0gbW9uc3RlcnNbaV07XHJcblxyXG4gICAgLy9Nb3ZlIHRoZSBtb25zdGVyc1xyXG4gICAgbW9uc3Rlci54ICs9IG1vbnN0ZXIudng7XHJcbiAgICBtb25zdGVyLnkgKz0gbW9uc3Rlci52eTtcclxuXHJcbiAgICAvL0NoZWNrIHdoZXRoZXIgdGhlIG1vbnN0ZXIgaXMgYXQgYSB0aWxlIGNvcm5lclxyXG4gICAgaWYoTWF0aC5mbG9vcihtb25zdGVyLngpICUgU0laRSA9PT0gMFxyXG4gICAgJiYgTWF0aC5mbG9vcihtb25zdGVyLnkpICUgU0laRSA9PT0gMCkge1xyXG4gICAgICAvL0NoYW5nZSB0aGUgbW9uc3RlcidzIGRpcmVjdGlvblxyXG4gICAgICBjaGFuZ2VEaXJlY3Rpb24obW9uc3Rlcik7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBlbmRHYW1lKCkge1xyXG4gIGFsZXJ0KFwiWW91IExvc3RcIik7XHJcbiAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCh0cnVlKVxyXG59XHJcblxyXG5mdW5jdGlvbiByZW5kZXIoKSB7XHJcbiAgZHJhd2luZ1N1cmZhY2UuY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcblxyXG4gIC8vRGlzcGxheSB0aGUgc3ByaXRlc1xyXG4gIGlmKHNwcml0ZXMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgc3ByaXRlcy5sZW5ndGg7IGkrKykge1xyXG5cdCAgbGV0IHNwcml0ZSA9IHNwcml0ZXNbaV07XHJcblx0ICBpZihzcHJpdGUudmlzaWJsZSkge1xyXG4gICAgICAgIGRyYXdpbmdTdXJmYWNlLmRyYXdJbWFnZVxyXG4gICAgICAgIChcclxuICAgICAgICAgICBpbWFnZSxcclxuICAgICAgICAgICBzcHJpdGUuc291cmNlWCwgc3ByaXRlLnNvdXJjZVksXHJcbiAgICAgICAgICAgc3ByaXRlLnNvdXJjZVdpZHRoLCBzcHJpdGUuc291cmNlSGVpZ2h0LFxyXG4gICAgICAgICAgIE1hdGguZmxvb3Ioc3ByaXRlLngpLCBNYXRoLmZsb29yKHNwcml0ZS55KSxcclxuICAgICAgICAgICBzcHJpdGUud2lkdGgsIHNwcml0ZS5oZWlnaHRcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG59KCkpO1xyXG4iXX0=